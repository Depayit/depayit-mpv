# DEPAYIT PRODUCTION TECH FULL STACK
# üõ°Ô∏è ‡∏ó‡∏ö‡∏ó‡∏ß‡∏ô‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á DEPAYIT 

‡∏´‡∏±‡∏ß‡πÉ‡∏à‡∏Ç‡∏≠‡∏á‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡πá‡∏Ñ‡∏Ñ‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á "‡πÄ‡∏Å‡∏£‡∏≤‡∏∞‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô" ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡∏Ñ‡∏ô‡πÑ‡∏ó‡∏¢‡∏ï‡∏Å‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏´‡∏¢‡∏∑‡πà‡∏≠‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏â‡πâ‡∏≠‡πÇ‡∏Å‡∏á‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå ‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ‡πÇ‡∏°‡πÄ‡∏î‡∏• Agency-Service Soft Escrow ‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏ñ‡∏π‡∏Å‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏°‡∏≤‡∏à‡∏≤‡∏Å Escrow ‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏Å‡∏±‡∏ô‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏≠‡∏™‡∏±‡∏á‡∏´‡∏≤‡πÅ‡∏•‡∏∞‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£ ‡∏ã‡∏∂‡πà‡∏á‡∏™‡∏¥‡πà‡∏á‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏ä‡∏ô‡πå‡∏°‡∏≤‡∏Å‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏ô‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ‡∏Ñ‡∏ô‡∏õ‡∏Å‡∏ï‡∏¥‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏≠‡∏∑‡πâ‡∏°‡∏ñ‡∏∂‡∏á‡πÑ‡∏î‡πâ
‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏±‡∏ß‡∏Å‡∏•‡∏≤‡∏á: ‡πÄ‡∏£‡∏≤‡∏ó‡∏≥‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô "‡∏ï‡∏±‡∏ß‡πÅ‡∏ó‡∏ô" ‡∏ñ‡∏∑‡∏≠‡πÄ‡∏á‡∏¥‡∏ô‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏ß‡πà‡∏≤ "‡∏à‡πà‡∏≤‡∏¢‡πÅ‡∏•‡πâ‡∏ß‡πÑ‡∏î‡πâ‡∏Ç‡∏≠‡∏á" ‡πÅ‡∏•‡∏∞ "‡∏™‡πà‡∏á‡∏Ç‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ß‡πÑ‡∏î‡πâ‡πÄ‡∏á‡∏¥‡∏ô" 
‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î: ‡πÉ‡∏ä‡πâ‡∏°‡∏≤‡∏ï‡∏£‡∏Å‡∏≤‡∏£ Triple Control (‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£, ‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó, 2FA) ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤-‡∏≠‡∏≠‡∏Å
‡∏Ñ‡∏ß‡∏≤‡∏°‡πÇ‡∏õ‡∏£‡πà‡∏á‡πÉ‡∏™: ‡∏ó‡∏∏‡∏Å‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÑ‡∏î‡πâ‡∏ú‡πà‡∏≤‡∏ô TXID-PIN ‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏™‡∏°‡∏±‡∏Ñ‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡πÉ‡∏´‡πâ‡∏¢‡∏∏‡πà‡∏á‡∏¢‡∏≤‡∏Å 
‡∏Å‡∏≤‡∏£‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏ü‡∏≠‡∏Å‡πÄ‡∏á‡∏¥‡∏ô

---

### 1. Frontend (Client-Side)

‡πÄ‡∏£‡∏≤‡πÄ‡∏ô‡πâ‡∏ô Mobile-First ‡πÅ‡∏•‡∏∞ Web App ‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÇ‡∏´‡∏•‡∏î‡πÅ‡∏≠‡∏õ‡∏Ø ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏á‡πà‡∏≤‡∏≤‡∏¢

- ‚úÖ **Framework:** **Next.js (React Framework)**
 - ***Why**:* ‡∏î‡∏µ‡∏Å‡∏ß‡πà‡∏≤‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô React ‡∏ò‡∏£‡∏£‡∏°‡∏î‡∏≤ ‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏ó‡∏≥ Server-Side Rendering (SSR) ‡πÑ‡∏î‡πâ ‡∏ã‡∏∂‡πà‡∏á‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡∏Å‡∏ß‡πà‡∏≤‡πÉ‡∏ô‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Token ‡πÅ‡∏•‡∏∞ SEO ‡∏î‡∏µ‡∏Å‡∏ß‡πà‡∏≤ (‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏°‡∏≤‡∏Å‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏ä‡∏£‡πå‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÉ‡∏´‡πâ‡∏ú‡∏π‡πâ‡∏ã‡∏∑‡πâ‡∏≠/‡∏ú‡∏π‡πâ‡∏Ç‡∏≤‡∏¢‡πÄ‡∏´‡πá‡∏ô‡∏û‡∏£‡∏µ‡∏ß‡∏¥‡∏ß‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏™‡∏ß‡∏¢‡πÜ)
- ‚úÖ **Language:** **TypeScript** (Strict Mode)
 - ***Why:*** ‡∏´‡πâ‡∏≤‡∏°‡πÉ‡∏ä‡πâ JavaScript ‡∏ò‡∏£‡∏£‡∏°‡∏î‡∏≤‡πÄ‡∏î‡πá‡∏î‡∏Ç‡∏≤‡∏î‡πÉ‡∏ô Fintech ‡∏Ñ‡∏£‡∏±‡∏ö TypeScript ‡∏ä‡πà‡∏ß‡∏¢‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô Human Error ‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏ú‡∏¥‡∏î‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó (‡πÄ‡∏ä‡πà‡∏ô ‡∏™‡πà‡∏á String ‡πÑ‡∏õ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÄ‡∏á‡∏¥‡∏ô) ‡πÑ‡∏î‡πâ‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏ï‡πà‡∏ï‡∏≠‡∏ô‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô Code
- ‚úÖ **State Management:** **TanStack Query (React Query)**
 - ***Why**:* ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Data Fetching ‡πÅ‡∏•‡∏∞ Caching ‡πÑ‡∏î‡πâ‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥ ‡∏•‡∏î‡∏†‡∏≤‡∏£‡∏∞ Server ‡πÅ‡∏•‡∏∞‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ Loading/Error ‡πÑ‡∏î‡πâ‡∏î‡∏µ‡∏°‡∏≤‡∏Å
- ‚úÖ **UI Library:** **Tailwind CSS + Shadcn/ui**
 - ***Why**:* ‡πÄ‡∏ö‡∏≤ ‡πÄ‡∏£‡πá‡∏ß ‡πÅ‡∏•‡∏∞‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏á‡πÑ‡∏î‡πâ‡∏á‡πà‡∏≤‡∏¢ ‡∏î‡∏π‡∏ó‡∏±‡∏ô‡∏™‡∏°‡∏±‡∏¢ ‡∏™‡∏£‡πâ‡∏≤‡∏á Trust ‡πÉ‡∏´‡πâ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ

### 2. Backend (Server-Side)

- **Framework:** **FastAPI (Python)**
  1. **Performance:** ‡πÄ‡∏£‡πá‡∏ß‡∏Å‡∏ß‡πà‡∏≤ Flask ‡∏°‡∏≤‡∏Å (Asynchronous) ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö Concurrent User ‡πÑ‡∏î‡πâ‡∏î‡∏µ‡∏Å‡∏ß‡πà‡∏≤
  2. **Data Validation:** ‡∏°‡∏µ **Pydantic** ‡πÉ‡∏ô‡∏ï‡∏±‡∏ß ‡∏ã‡∏∂‡πà‡∏á‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Fintech ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤ (‡∏ä‡∏∑‡πà‡∏≠, ‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô, ‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ç‡∏ä‡∏µ) ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Type ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏Ñ‡∏£‡πà‡∏á‡∏Ñ‡∏£‡∏±‡∏î ‡∏ñ‡πâ‡∏≤‡∏ú‡∏¥‡∏î format ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏î‡∏µ‡∏î‡∏≠‡∏≠‡∏Å‡∏ó‡∏±‡∏ô‡∏ó‡∏µ ‡∏•‡∏î‡∏ö‡∏±‡πä‡∏Å‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡∏¢‡∏∞
  3. **Auto-Doc:** ‡∏™‡∏£‡πâ‡∏≤‡∏á Swagger UI ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ ‡∏ó‡∏µ‡∏° Dev ‡πÅ‡∏•‡∏∞ Partner (Bank/3rd Party) ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏á‡πà‡∏≤‡∏¢‡∏Ç‡∏∂‡πâ‡∏ô
- **Language:** **Python 3.11+**
- **Architecture:** **Modular Monolith**
 - ‡πÉ‡∏ô‡∏ä‡πà‡∏ß‡∏á‡πÅ‡∏£‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏á‡∏ó‡∏≥ Microservices (‡∏à‡∏∞‡∏ã‡∏±‡∏ö‡∏ã‡πâ‡∏≠‡∏ô‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ó‡∏µ‡∏° 3-5 ‡∏Ñ‡∏ô) ‡πÉ‡∏´‡πâ‡∏ó‡∏≥ Monolith ‡∏ó‡∏µ‡πà‡πÅ‡∏ö‡πà‡∏á Module ‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô (Payment, User, Dispute, Notification) ‡∏ß‡∏±‡∏ô‡∏´‡∏•‡∏±‡∏á‡πÅ‡∏¢‡∏Å Service ‡πÑ‡∏î‡πâ‡∏á‡πà‡∏≤‡∏¢

### 3. Database & Storage - *The Vault*

- **Primary Database:** **PostgreSQL** (Managed Service ‡∏ö‡∏ô Supabase ‡∏´‡∏£‡∏∑‡∏≠ AWS RDS)
    - *Why:* ‡πÄ‡∏õ‡πá‡∏ô‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á Fintech ‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ RDBMS ‡∏ó‡∏µ‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö **ACID Compliance** (Atomicity, Consistency, Isolation, Durability) ‡∏ò‡∏∏‡∏£‡∏Å‡∏£‡∏£‡∏°‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô‡∏ï‡πâ‡∏≠‡∏á "‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î" ‡∏´‡∏£‡∏∑‡∏≠ "‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î" ‡∏´‡πâ‡∏≤‡∏°‡∏°‡∏µ‡∏Å‡∏£‡∏ì‡∏µ‡πÄ‡∏á‡∏¥‡∏ô‡∏ï‡∏±‡∏î‡πÅ‡∏•‡πâ‡∏ß‡πÅ‡∏ï‡πà‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÑ‡∏°‡πà‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÄ‡∏î‡πá‡∏î‡∏Ç‡∏≤‡∏î
- **Caching & Queue:** **Redis**
    - *Why:* ‡πÉ‡∏ä‡πâ‡πÄ‡∏Å‡πá‡∏ö Session ‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß, Rate Limiting (‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏¢‡∏¥‡∏á API ‡∏£‡∏±‡∏ß‡πÜ), ‡πÅ‡∏•‡∏∞‡πÉ‡∏ä‡πâ‡πÄ‡∏õ‡πá‡∏ô Message Broker ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏£‡∏∞‡∏ö‡∏ö Queue (‡πÄ‡∏ä‡πà‡∏ô ‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á Webhook ‡πÑ‡∏õ‡∏´‡∏≤ Bank ‡∏´‡∏£‡∏∑‡∏≠‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô)
- **Object Storage:** **AWS S3** (‡∏´‡∏£‡∏∑‡∏≠ Supabase Storage)
    - *Why:* ‡πÄ‡∏Å‡πá‡∏ö‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô‡∏™‡∏•‡∏¥‡∏õ‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô ‡πÅ‡∏•‡∏∞‡∏£‡∏π‡∏õ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ (‡∏Ñ‡∏ß‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô Private Bucket ‡πÅ‡∏•‡∏∞‡πÉ‡∏ä‡πâ Signed URL ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢)

### 4. Infrastructure & Security - *The Shield*

- **Hosting:** **AWS (Amazon Web Services)** ‡∏´‡∏£‡∏∑‡∏≠ **Google Cloud (GCP)**
    - *‡∏ó‡∏≥‡πÑ‡∏°‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πâ Render ‡∏ï‡πà‡∏≠?:* Render ‡∏î‡∏µ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö MVP ‡πÅ‡∏ï‡πà‡∏ñ‡πâ‡∏≤‡∏à‡∏∞ Scale ‡πÅ‡∏•‡∏∞‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ Compliance (‡πÄ‡∏ä‡πà‡∏ô ‡πÄ‡∏Å‡πá‡∏ö Log ‡∏ï‡∏≤‡∏° ‡∏û.‡∏£.‡∏ö. ‡∏Ñ‡∏≠‡∏°‡∏Ø, ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Network Security ‡∏ó‡∏µ‡πà‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î) Cloud Provider ‡πÉ‡∏´‡∏ç‡πà‡πÜ ‡∏à‡∏∞‡∏ï‡∏≠‡∏ö‡πÇ‡∏à‡∏ó‡∏¢‡πå‡∏Å‡∏ß‡πà‡∏≤ ‡πÅ‡∏ï‡πà‡∏ñ‡πâ‡∏≤‡∏ó‡∏µ‡∏°‡∏¢‡∏±‡∏á‡πÄ‡∏•‡πá‡∏Å‡∏°‡∏≤‡∏Å ‡∏≠‡∏≤‡∏à‡∏à‡∏∞‡πÉ‡∏ä‡πâ **Railway** ‡∏´‡∏£‡∏∑‡∏≠ **Render (Enterprise)** ‡πÑ‡∏õ‡∏Å‡πà‡∏≠‡∏ô‡πÑ‡∏î‡πâ ‡πÅ‡∏ï‡πà‡∏ï‡πâ‡∏≠‡∏á Config Security Group ‡πÉ‡∏´‡πâ‡∏î‡∏µ
- **Containerization:** **Docker**
    - *Why:* Environment ‡∏Ç‡∏≠‡∏á Dev, Test, ‡πÅ‡∏•‡∏∞ Production ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏Å‡∏±‡∏ô 100%
- **API Gateway / Proxy:** **Cloudflare**
    - *Why:* ‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏°‡∏≤‡∏Å! ‡∏ä‡πà‡∏ß‡∏¢‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô DDoS Attack, ‡∏ã‡πà‡∏≠‡∏ô Real IP ‡∏Ç‡∏≠‡∏á Server, ‡πÅ‡∏•‡∏∞‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ SSL/TLS Certificate ‡πÉ‡∏´‡πâ
- **Secret Management:** **AWS Secrets Manager** ‡∏´‡∏£‡∏∑‡∏≠ **Doppler**
    - *Why:* ‡∏´‡πâ‡∏≤‡∏° Hardcode ‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô Database ‡∏´‡∏£‡∏∑‡∏≠ API Key ‡πÉ‡∏ô Code ‡πÄ‡∏î‡πá‡∏î‡∏Ç‡∏≤‡∏î

## ‡πÄ‡∏à‡∏≤‡∏∞‡∏•‡∏∂‡∏Å‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢ (Security Implementation)

**1. Double-Entry Bookkeeping Logic (‡∏£‡∏∞‡∏ö‡∏ö‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏Ñ‡∏π‡πà)**
‡πÅ‡∏°‡πâ‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô Soft Escrow ‡πÅ‡∏ï‡πà‡πÉ‡∏ô Database ‡∏´‡πâ‡∏≤‡∏°‡πÄ‡∏Å‡πá‡∏ö‡πÅ‡∏Ñ‡πà‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠ (Balance)

- **‡∏ï‡πâ‡∏≠‡∏á‡∏ó‡∏≥:** ‡∏ï‡πâ‡∏≠‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏ö‡∏ö Debit/Credit ‡πÉ‡∏ô‡∏ó‡∏∏‡∏Å Transaction
    - *Table:* `ledger_entries` (id, transaction_id, account_type, amount, direction, timestamp)
    - *Logic:* ‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏ö‡∏±‡∏ç‡∏ä‡∏µ Cashflow (+1000) ‡∏ï‡πâ‡∏≠‡∏á‡∏Ñ‡∏π‡πà‡∏Å‡∏±‡∏ö ‡∏´‡∏ô‡∏µ‡πâ‡∏™‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏à‡πà‡∏≤‡∏¢‡∏ú‡∏π‡πâ‡∏Ç‡∏≤‡∏¢ (+1000) ‡∏ú‡∏•‡∏£‡∏ß‡∏°‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô 0 ‡πÄ‡∏™‡∏°‡∏≠ ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÄ‡∏á‡∏¥‡∏ô‡∏´‡∏≤‡∏¢‡πÑ‡∏õ‡πÅ‡∏°‡πâ‡πÅ‡∏ï‡πà‡∏™‡∏ï‡∏≤‡∏á‡∏Ñ‡πå‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡πá‡∏£‡∏π‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ

**2. State Machine ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Transaction**
‡∏´‡πâ‡∏≤‡∏°‡πÉ‡∏ä‡πâ `if-else` ‡∏á‡πà‡∏≤‡∏¢‡πÜ ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô ‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ **State Machine Pattern**

- *States:* `CREATED` -> `PAYMENT_PENDING` -> `PAID` -> `DELIVERY_PENDING` -> `DELIVERED` -> `COMPLETED` (‡∏´‡∏£‡∏∑‡∏≠ `DISPUTE`)
- *Logic:* ‡∏Å‡∏≥‡∏´‡∏ô‡∏î Transition ‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏°‡∏á‡∏ß‡∏î ‡πÄ‡∏ä‡πà‡∏ô ‡∏à‡∏∞‡∏Ç‡πâ‡∏≤‡∏°‡∏à‡∏≤‡∏Å `CREATED` ‡πÑ‡∏õ `COMPLETED` ‡πÄ‡∏•‡∏¢‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ ‡∏ï‡πâ‡∏≠‡∏á‡∏ú‡πà‡∏≤‡∏ô‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô

**3. Triple Control Implementation (‡∏ï‡∏≤‡∏°‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£)**

- **Layer 1 (Bank):** ‡πÉ‡∏ä‡πâ Webhook Signature Verification ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ Callback ‡∏ó‡∏µ‡πà‡∏¢‡∏¥‡∏á‡∏°‡∏≤‡∏ß‡πà‡∏≤ "‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡πÅ‡∏•‡πâ‡∏ß" ‡∏°‡∏≤‡∏à‡∏≤‡∏Å‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£‡∏à‡∏£‡∏¥‡∏á‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà (‡∏´‡πâ‡∏≤‡∏°‡πÄ‡∏ä‡∏∑‡πà‡∏≠ Data Body ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏ä‡πá‡∏Ñ Signature Header)
- **Layer 2 (Company):** ‡∏°‡∏µ Admin Dashboard ‡∏ó‡∏µ‡πà‡πÅ‡∏¢‡∏Å‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå (Role-Based Access Control - RBAC) ‡∏Ñ‡∏ô‡∏Å‡∏î‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥ ‡∏Å‡∏±‡∏ö‡∏Ñ‡∏ô‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ï‡πâ‡∏≠‡∏á‡∏Ñ‡∏ô‡∏•‡∏∞‡∏Ñ‡∏ô‡∏Å‡∏±‡∏ô (Maker-Checker Concept)
- **Layer 3 (2FA):** ‡πÉ‡∏ä‡πâ TOTP (Time-based One-Time Password) ‡πÄ‡∏ä‡πà‡∏ô Google Authenticator ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Admin ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏Å‡∏î Release ‡πÄ‡∏á‡∏¥‡∏ô ‡∏´‡∏£‡∏∑‡∏≠‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç

**4. Data Privacy (PDPA)**

- **Encryption at Rest:** ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡πà‡∏≠‡∏ô‡πÑ‡∏´‡∏ß (‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏ä‡∏ä., ‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ç‡∏ä‡∏µ) ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡∏´‡∏±‡∏™‡πÉ‡∏ô Database (‡πÉ‡∏ä‡πâ AES-256)
- **Data Minimization:** ‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ó‡∏µ‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô ‡πÅ‡∏•‡∏∞‡∏°‡∏µ‡∏£‡∏∞‡∏ö‡∏ö Auto-delete ‡∏´‡∏£‡∏∑‡∏≠ Anonymize ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏û‡πâ‡∏ô‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏≤‡∏á‡∏Å‡∏é‡∏´‡∏°‡∏≤‡∏¢ (Retention Policy)

### ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á Structure (Python FastAPI)

‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÄ‡∏´‡πá‡∏ô‡∏†‡∏≤‡∏û ‡∏ú‡∏°‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á Code ‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô‡πÉ‡∏´‡πâ

```python
# models/transaction.py
from enum import Enum
from pydantic import BaseModel, Field, validator
from datetime import datetime

class TransactionStatus(str, Enum):
    CREATED = "CREATED"
    WAITING_PAYMENT = "WAITING_PAYMENT"
    PAID_ESCROW = "PAID_ESCROW"
    SHIPPED = "SHIPPED"
    COMPLETED = "COMPLETED"
    DISPUTE = "DISPUTE"
    REFUNDED = "REFUNDED"

class CreateTransactionRequest(BaseModel):
    product_name: str = Field(..., min_length=3, max_length=100)
    amount: float = Field(..., gt=0) # ‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤ 0 ‡πÄ‡∏™‡∏°‡∏≠
    seller_id: str
    buyer_id: str = None # ‡∏≠‡∏≤‡∏à‡∏à‡∏∞‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ï‡∏≠‡∏ô‡∏™‡∏£‡πâ‡∏≤‡∏á Link

    @validator('amount')
    def validate_amount(cls, v):
        # ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏ó‡∏®‡∏ô‡∏¥‡∏¢‡∏°‡πÄ‡∏Å‡∏¥‡∏ô 2 ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á (Floating point error)
        return round(v, 2)

# services/payment_service.py
class PaymentService:
    async def process_webhook(self, signature: str, payload: dict):
        # 1. Security Check: Verify Bank Signature
        if not self.verify_bank_signature(signature, payload):
            raise SecurityException("Invalid Signature")

        # 2. Idempotency Check: ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏¢‡∏¥‡∏á‡∏ã‡πâ‡∏≥ (‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß ‡πÅ‡∏ï‡∏£‡∏∞‡∏ö‡∏ö‡∏£‡∏±‡∏ô 2 ‡∏£‡∏≠‡∏ö)
        if await self.repo.is_transaction_processed(payload['tx_ref']):
            return {"status": "already_processed"}

        # 3. Transaction Logic (ACID Transaction)
        async with self.db.transaction():
            # Update status
            # Insert Ledger Entry
            # Trigger Notification
            pass
```

### ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç 

1. **Logging ‡∏Ñ‡∏∑‡∏≠‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï:** ‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô Log ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏Å‡∏ß‡πà‡∏≤ Code ‡∏ó‡∏∏‡∏Å Step (User login, User click pay, Webhook received, Auto-release trigger) ‡∏ï‡πâ‡∏≠‡∏á‡∏ñ‡∏π‡∏Å‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ß‡πâ‡πÉ‡∏ô Centralized Logging (‡πÄ‡∏ä‡πà‡∏ô CloudWatch ‡∏´‡∏£‡∏∑‡∏≠ Datadog) ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ‡∏™‡∏π‡πâ‡∏Ñ‡∏î‡∏µ‡∏´‡∏£‡∏∑‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ‡∏õ‡∏±‡∏ç‡∏´‡∏≤
2. **Idempotency Key:** ‡∏£‡∏∞‡∏ö‡∏ö‡∏£‡∏±‡∏ö‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö Idempotency ‡∏Ñ‡∏∑‡∏≠‡∏ñ‡πâ‡∏≤ Bank ‡∏¢‡∏¥‡∏á Webhook ‡∏°‡∏≤‡∏ã‡πâ‡∏≥ 2 ‡∏£‡∏≠‡∏ö ‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏£‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏°‡πà‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏≠‡∏≠‡∏Å 2 ‡∏£‡∏≠‡∏ö ‡∏´‡∏£‡∏∑‡∏≠‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏¢‡∏≠‡∏î‡∏ã‡πâ‡∏≥
3. **‡∏≠‡∏¢‡πà‡∏≤‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏£‡∏∞‡∏ö‡∏ö PromptPay QR ‡πÄ‡∏≠‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î:** ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏´‡πâ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö Payment Gateway ‡∏ó‡∏µ‡πà‡∏°‡∏µ License (‡πÄ‡∏ä‡πà‡∏ô GB Prime Pay ‡∏´‡∏£‡∏∑‡∏≠ ChillPay) ‡∏´‡∏£‡∏∑‡∏≠ Bank API ‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á (KBANK/SCB Open API) ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏•‡∏î‡∏†‡∏≤‡∏£‡∏∞ PCI-DSS ‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡πÉ‡∏ô‡∏Å‡∏≤‡∏£ Generate QR ‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î
4. **‡πÅ‡∏¢‡∏Å Domain Logic ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å Infrastructure:** ‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô‡πÑ‡∏°‡πà‡∏Ñ‡∏ß‡∏£‡πÉ‡∏´‡πâ Logic ‡∏Å‡∏≤‡∏£‡∏õ‡∏•‡πà‡∏≠‡∏¢‡πÄ‡∏á‡∏¥‡∏ô (Auto-Release) ‡∏ú‡∏π‡∏Å‡∏ï‡∏¥‡∏î‡∏Å‡∏±‡∏ö Database ‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏¢‡∏Å use_cases ‡∏à‡∏∞‡∏ä‡πà‡∏ß‡∏¢‡πÉ‡∏´‡πâ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ó‡∏î‡∏™‡∏≠‡∏ö (Unit Test) ‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏Å‡∏≤‡∏£‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡πÑ‡∏î‡πâ‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥ 100% ‡∏Å‡πà‡∏≠‡∏ô‡∏ô‡∏≥‡πÑ‡∏õ‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö‡∏£‡∏∞‡∏ö‡∏ö‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£‡∏à‡∏£‡∏¥‡∏á
5. **‡∏£‡∏∞‡∏ö‡∏ö Triple Control (Triple-Layer Security):** ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏ô services/core-engine/infrastructure/ ‡∏à‡∏∞‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏°‡∏≤‡∏ï‡∏£‡∏Å‡∏≤‡∏£‡∏Å‡∏î‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô 3 ‡∏™‡πà‡∏ß‡∏ô (Bank, Company, 2FA)  ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏ö‡∏±‡∏ç‡∏ä‡∏µ Cashflow ‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡πÄ‡∏Å‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡∏ó‡∏∏‡∏à‡∏£‡∏¥‡∏ï‡∏†‡∏≤‡∏¢‡πÉ‡∏ô‡πÑ‡∏î‡πâ
6. **‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ TXID & PIN:** ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏µ‡πà‡∏¢‡∏á‡∏Å‡∏≤‡∏£‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å (No Membership) ‡∏à‡∏∞‡πÉ‡∏ä‡πâ‡∏£‡∏∞‡∏ö‡∏ö Stateless Tracking ‡πÉ‡∏ô‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå shared/utils ‡∏ó‡∏µ‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏´‡∏±‡∏™‡∏ó‡∏µ‡πà‡∏¢‡∏≤‡∏Å‡∏ï‡πà‡∏≠‡∏Å‡∏≤‡∏£‡∏™‡∏∏‡πà‡∏° (Unique & Secure) ‡πÅ‡∏ï‡πà‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏á‡πà‡∏≤‡∏¢‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ú‡πà‡∏≤‡∏ô Browser
7. **Compliance & PDPA:** ‡πÉ‡∏ô‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå docs/legal ‡πÅ‡∏•‡∏∞ services/kyc-service ‡∏à‡∏∞‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏Å‡πá‡∏ö Consent Log ‡πÅ‡∏•‡∏∞‡∏ó‡∏≥ Data Masking ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô‡∏ï‡∏≤‡∏°‡∏Å‡∏é‡∏´‡∏°‡∏≤‡∏¢ PDPA ‡∏Ç‡∏≠‡∏á‡πÑ‡∏ó‡∏¢‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏Ñ‡∏£‡πà‡∏á‡∏Ñ‡∏£‡∏±‡∏î

---

> **Database Schema (ER Diagram)**
> 

> ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö **Depayit** ‡∏ó‡∏µ‡πà‡πÄ‡∏ô‡πâ‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡πÇ‡∏õ‡∏£‡πà‡∏á‡πÉ‡∏™ (Transparency) ‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥ (Accuracy) ‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö Schema ‡∏ô‡∏µ‡πâ‡πÇ‡∏î‡∏¢‡∏¢‡∏∂‡∏î‡∏´‡∏•‡∏±‡∏Å **Normalised Relational Database** ‡∏ú‡∏™‡∏°‡∏Å‡∏±‡∏ö‡πÅ‡∏ô‡∏ß‡∏Ñ‡∏¥‡∏î **Double-Entry Accounting** ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î‡∏Ñ
> 

---

## Depayit Production Database Schema (ER Diagram)

‡∏ô‡∏µ‡πà‡∏Ñ‡∏∑‡∏≠‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡∏•‡∏±‡∏Å‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡πÉ‡∏ä‡πâ‡∏ö‡∏ô **PostgreSQL** 

```python
erDiagram
    USERS ||--o{ TRANSACTIONS : "creates/participates"
    USERS ||--o{ KYCS : "verifies"
    TRANSACTIONS ||--|{ LEDGER_ENTRIES : "has financial records"
    TRANSACTIONS ||--o| SHIPMENTS : "has delivery info"
    TRANSACTIONS ||--o| DISPUTES : "may have"
    DISPUTES ||--|{ DISPUTE_EVIDENCE : "contains"

    USERS {
        uuid id PK
        string phone_number UK "Verified"
        string email
        string password_hash
        enum role "BUYER, SELLER, ADMIN"
        enum kyc_tier "TIER_1, TIER_2, TIER_3"
        float trust_score "Default 100"
        jsonb metadata "Device Fingerprint, IP"
        timestamp created_at
    }

    TRANSACTIONS {
        uuid id PK
        string txid UK "Human readable e.g., TX-2505-XXXX"
        string pin_hash "Hashed 6-digit PIN"
        decimal amount "Precision 18, Scale 2"
        decimal fee "Platform Fee"
        enum status "CREATED, PENDING_PAYMENT, PAID, SHIPPED, COMPLETED, DISPUTE, REFUNDED"
        uuid seller_id FK
        uuid buyer_id FK "Nullable initially"
        timestamp auto_release_at "Trigger time for 48h rule"
        timestamp created_at
        timestamp updated_at
    }

    LEDGER_ENTRIES {
        uuid id PK
        uuid transaction_id FK
        enum account_type "CASHFLOW_BANK, ESCROW_LIABILITY, REVENUE, USER_PAYABLE"
        enum entry_type "DEBIT, CREDIT"
        decimal amount
        string reference_code "Bank Ref / Audit Ref"
        timestamp recorded_at
    }

    SHIPMENTS {
        uuid id PK
        uuid transaction_id FK
        string tracking_number
        string courier_name
        string seller_bank_account "Encrypted"
        string seller_bank_name
        timestamp shipped_at
        timestamp delivered_at
    }

    DISPUTES {
        uuid id PK
        uuid transaction_id FK
        enum reason "ITEM_NOT_RECEIVED, ITEM_MISMATCH, DAMAGED"
        enum status "OPEN, UNDER_REVIEW, RESOLVED_REFUND, RESOLVED_RELEASE"
        text description
        timestamp created_at
        timestamp resolved_at
    }
```

## ‡πÄ‡∏à‡∏≤‡∏∞‡∏•‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç (Key Implementation Details)

‡∏ú‡∏°‡∏Ç‡∏≠‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏ï‡∏£‡∏£‡∏Å‡∏∞‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏´‡∏•‡∏±‡∏á‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏ï‡∏≤‡∏£‡∏≤‡∏á ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏ó‡∏µ‡∏° Dev ‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ô‡∏Ñ‡∏£‡∏±‡∏ö:

### 1. `transactions` (‡∏´‡∏±‡∏ß‡πÉ‡∏à‡∏Ç‡∏≠‡∏á‡∏£‡∏∞‡∏ö‡∏ö)

- ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ô‡∏µ‡πâ‡πÄ‡∏Å‡πá‡∏ö State ‡∏Ç‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ã‡∏∑‡πâ‡∏≠‡∏Ç‡∏≤‡∏¢‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î

**`txid` & `pin_hash`:** ‡∏ï‡∏≤‡∏°‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£  ‡πÄ‡∏£‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ **TXID** ‡πÉ‡∏´‡πâ‡∏Ñ‡∏ô‡∏à‡∏≥‡∏á‡πà‡∏≤‡∏¢ ‡πÅ‡∏ï‡πà **PIN** (6 ‡∏´‡∏•‡∏±‡∏Å) ‡∏ï‡πâ‡∏≠‡∏á **Hash** (‡πÉ‡∏ä‡πâ Argon2 ‡∏´‡∏£‡∏∑‡∏≠ bcrypt) ‡πÄ‡∏Å‡πá‡∏ö‡∏•‡∏á Database ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô ‡∏´‡πâ‡∏≤‡∏°‡πÄ‡∏Å‡πá‡∏ö Plain text ‡πÄ‡∏î‡πá‡∏î‡∏Ç‡∏≤‡∏î ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô

**`auto_release_at`:** ‡∏ü‡∏¥‡∏•‡∏î‡πå‡∏ô‡∏µ‡πâ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏°‡∏≤‡∏Å‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏£‡∏∞‡∏ö‡∏ö **Auto-Release**  ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô `SHIPPED` ‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡πâ‡∏≠‡∏á‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÄ‡∏ß‡∏•‡∏≤ `Now() + 48 Hours` ‡πÉ‡∏™‡πà‡∏ü‡∏¥‡∏•‡∏î‡πå‡∏ô‡∏µ‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ Cron Job ‡∏´‡∏£‡∏∑‡∏≠ Celery Worker ‡∏°‡∏≤‡∏î‡∏∂‡∏á‡πÑ‡∏õ‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥

**`buyer_id`:** ‡∏ú‡∏°‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏õ‡πá‡∏ô Nullable (‡∏ß‡πà‡∏≤‡∏á‡πÑ‡∏î‡πâ) ‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏ï‡∏≠‡∏ô‡∏ú‡∏π‡πâ‡∏Ç‡∏≤‡∏¢‡∏™‡∏£‡πâ‡∏≤‡∏á Link ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å ‡∏≠‡∏≤‡∏à‡∏à‡∏∞‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏£‡∏π‡πâ‡∏ß‡πà‡∏≤‡πÉ‡∏Ñ‡∏£‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏ô‡∏ã‡∏∑‡πâ‡∏≠ ‡∏à‡∏ô‡∏Å‡∏ß‡πà‡∏≤‡∏ú‡∏π‡πâ‡∏ã‡∏∑‡πâ‡∏≠‡∏à‡∏∞‡∏Å‡∏î‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÅ‡∏•‡∏∞‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•

### 2. `ledger_entries` (‡∏™‡∏°‡∏∏‡∏î‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡πÅ‡∏¢‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó - ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô)

‡∏ô‡∏µ‡πà‡∏Ñ‡∏∑‡∏≠‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÄ‡∏£‡∏≤‡∏ï‡πà‡∏≤‡∏á‡∏à‡∏≤‡∏Å‡πÅ‡∏≠‡∏õ‡∏Ø ‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ ‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πâ‡πÅ‡∏Ñ‡πà‡∏ü‡∏¥‡∏•‡∏î‡πå `balance` ‡πÅ‡∏ï‡πà‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÑ‡∏´‡∏•‡∏Ç‡∏≠‡∏á‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏∏‡∏Å‡∏ö‡∏≤‡∏ó

- **Concept:** ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏ã‡∏∑‡πâ‡∏≠‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô 1,000 ‡∏ö‡∏≤‡∏ó ‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤ ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å 2 ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î (Double Entry):
    1. **Debit:** `CASHFLOW_BANK` (+1,000) -> ‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó‡∏à‡∏£‡∏¥‡∏á
    2. **Credit:** `ESCROW_LIABILITY` (+1,000) -> ‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó‡∏°‡∏µ‡∏´‡∏ô‡∏µ‡πâ‡∏™‡∏¥‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡∏à‡πà‡∏≤‡∏¢‡∏Ñ‡∏∑‡∏ô (‡πÉ‡∏´‡πâ‡∏ú‡∏π‡πâ‡∏Ç‡∏≤‡∏¢ ‡∏´‡∏£‡∏∑‡∏≠‡∏Ñ‡∏∑‡∏ô‡∏ú‡∏π‡πâ‡∏ã‡∏∑‡πâ‡∏≠)

*Why:* ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ô‡∏µ‡πâ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÄ‡∏£‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÑ‡∏î‡πâ‡∏ï‡∏•‡∏≠‡∏î‡πÄ‡∏ß‡∏•‡∏≤‡∏ß‡πà‡∏≤‡πÄ‡∏á‡∏¥‡∏ô‡πÉ‡∏ô‡∏ö‡∏±‡∏ç‡∏ä‡∏µ Bank ‡∏Ç‡∏≠‡∏á‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏¢‡∏≠‡∏î‡∏´‡∏ô‡∏µ‡πâ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏à‡πà‡∏≤‡∏¢‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÑ‡∏´‡∏° (Reconciliation) ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏£‡∏±‡πà‡∏ß‡πÑ‡∏´‡∏• ‡πÅ‡∏•‡∏∞‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏á‡πà‡∏≤‡∏¢‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Auditor

### 3. `shipments` (‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏°‡∏≠‡∏ö)

**`seller_bank_account`:** ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡∏Ç‡∏≤‡∏¢‡∏ï‡πâ‡∏≠‡∏á‡∏ñ‡∏π‡∏Å **Encrypt** (‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡∏´‡∏±‡∏™) ‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏Å‡πá‡∏ö‡∏•‡∏á DB (Level: Database Encryption) ‡∏ï‡∏≤‡∏°‡∏Å‡∏é **PDPA**  ‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡πà‡∏≠‡∏ô‡πÑ‡∏´‡∏ß ‡∏ñ‡πâ‡∏≤ DB ‡∏´‡∏•‡∏∏‡∏î ‡∏Å‡πá‡πÄ‡∏≠‡∏≤‡πÑ‡∏õ‡πÉ‡∏ä‡πâ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ

**`delivered_at`:** ‡πÉ‡∏ä‡πâ API ‡∏à‡∏≤‡∏Å‡∏Ç‡∏ô‡∏™‡πà‡∏á‡∏°‡∏≤ Update ‡∏ü‡∏¥‡∏•‡∏î‡πå‡∏ô‡∏µ‡πâ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ô‡∏±‡∏ö‡∏ñ‡∏≠‡∏¢‡∏´‡∏•‡∏±‡∏á 48 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á‡∏ï‡∏≤‡∏°‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç Auto-Release

### 4. `users` & `kyc_tier`

**`kyc_tier`:** ‡πÉ‡∏ä‡πâ‡∏Ñ‡∏±‡∏î‡∏Å‡∏£‡∏≠‡∏á‡∏ß‡∏á‡πÄ‡∏á‡∏¥‡∏ô‡∏ï‡∏≤‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á (Risk-Based Approach) ‡∏ï‡∏≤‡∏°‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£:

- *TIER_1:* ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£ (‡πÄ‡∏ó‡∏£‡∏î‡πÑ‡∏î‡πâ < 30,000)
- *TIER_2:* ‡∏ö‡∏±‡∏ï‡∏£ ‡∏õ‡∏ä‡∏ä. (‡πÄ‡∏ó‡∏£‡∏î‡πÑ‡∏î‡πâ < 100,000)
- *TIER_3:* NDID/e-KYC (‡πÄ‡∏ó‡∏£‡∏î‡πÑ‡∏î‡πâ > 100,000)

---

## ‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö CTO (Pro Tips)

1. **Database Indexing:**
    - ‡∏≠‡∏¢‡πà‡∏≤‡∏•‡∏∑‡∏°‡∏ó‡∏≥ Index ‡∏ó‡∏µ‡πà `txid`, `seller_id`, `buyer_id` ‡πÅ‡∏•‡∏∞ `status` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ò‡∏∏‡∏£‡∏Å‡∏£‡∏£‡∏°‡πÄ‡∏£‡πá‡∏ß
    - ‡∏ó‡∏≥ Index ‡∏ó‡∏µ‡πà `auto_release_at` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ Worker ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÄ‡∏Ñ‡∏™‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏≠‡∏≠‡∏Å‡πÑ‡∏î‡πâ‡πÑ‡∏ß ‡πÑ‡∏°‡πà‡πÄ‡∏õ‡∏•‡∏∑‡∏≠‡∏á CPU
2. **Concurrency Control (‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏°‡∏≤‡∏Å!):**
    - ‡πÉ‡∏ô‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏∞‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£ Update ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏á‡∏¥‡∏ô (‡πÄ‡∏ä‡πà‡∏ô ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏∞‡∏ú‡∏π‡πâ‡∏ã‡∏∑‡πâ‡∏≠‡∏Å‡∏î‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏£‡∏±‡∏ö‡∏Ç‡∏≠‡∏á) ‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ **Row-Level Locking** (`SELECT ... FOR UPDATE`) ‡πÉ‡∏ô transaction block ‡∏Ç‡∏≠‡∏á SQL ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô **Race Condition** (‡πÄ‡∏ä‡πà‡∏ô ‡∏ú‡∏π‡πâ‡∏ã‡∏∑‡πâ‡∏≠‡∏Å‡∏î‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡∏±‡∏ö‡∏Å‡∏î‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡πÉ‡∏ô‡πÄ‡∏™‡∏µ‡πâ‡∏¢‡∏ß‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô)
3. **Audit Trail:**
    - ‡∏ô‡∏≠‡∏Å‡∏à‡∏≤‡∏Å Ledger ‡πÅ‡∏•‡πâ‡∏ß‡∏°‡∏µ‡∏ï‡∏≤‡∏£‡∏≤‡∏á `activity_logs` ‡πÄ‡∏Å‡πá‡∏ö‡∏ó‡∏∏‡∏Å Action (‡πÉ‡∏Ñ‡∏£, ‡∏ó‡∏≥‡∏≠‡∏∞‡πÑ‡∏£, ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÑ‡∏´‡∏£‡πà, IP ‡πÑ‡∏´‡∏ô) ‡πÇ‡∏î‡∏¢‡πÄ‡∏â‡∏û‡∏≤‡∏∞ Action ‡∏Ç‡∏≠‡∏á Admin ‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ‡∏¢‡∏∏‡πà‡∏á‡∏Å‡∏±‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ Dispute ‡∏´‡∏£‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡∏õ‡∏•‡∏î‡∏•‡πá‡∏≠‡∏Ñ‡πÄ‡∏á‡∏¥‡∏ô

---

> ‡πÅ‡∏ö‡∏ö‡∏£‡πà‡∏≤‡∏á **API Specification (RESTful Design)** ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö **Depayit** API ‡∏ñ‡∏π‡∏Å‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö‡πÇ‡∏î‡∏¢‡∏≠‡∏¥‡∏á‡∏à‡∏≤‡∏Å **FastAPI** ‡πÄ‡∏ô‡πâ‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢ (Security), ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô (Clarity) ‡πÅ‡∏•‡∏∞‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏Ç‡∏¢‡∏≤‡∏¢‡∏ï‡∏±‡∏ß (Scalability) ‡πÇ‡∏î‡∏¢‡πÅ‡∏ö‡πà‡∏á‡πÄ‡∏õ‡πá‡∏ô Module ‡∏´‡∏•‡∏±‡∏Å‡πÜ ‡∏ï‡∏≤‡∏° Business Logic
> 

---

## Depayit API Specification (Production Grade)

**Base URL:** `https://api.depayit.com/v1`**Authentication:** Bearer Token (JWT) ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö User ‡∏ó‡∏µ‡πà Login ‡πÅ‡∏•‡∏∞ API Key Signature ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Webhook ‡∏à‡∏≤‡∏Å‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£

### 1. Authentication & KYC Module (‡∏î‡πà‡∏≤‡∏ô‡∏´‡∏ô‡πâ‡∏≤)

*‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ï‡∏±‡∏ß‡∏ï‡∏ô‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á (Risk Tiers)*

- **`POST /auth/otp/request`**
    - **‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà:** ‡∏Ç‡∏≠ OTP ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£ (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö User ‡πÉ‡∏´‡∏°‡πà/Tier 1)
    - **Body:** `{ "phone_number": "+66xxxxxxxxx" }`
- **`POST /auth/otp/verify`**
    - **‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà:** ‡∏™‡πà‡∏á OTP ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏±‡∏ö Access Token (JWT)
    - **Response:** `{ "access_token": "...", "user_id": "...", "kyc_tier": "TIER_1" }`
- **`POST /kyc/upgrade`**
    - **‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà:** ‡∏≠‡∏±‡∏õ‡πÄ‡∏Å‡∏£‡∏î‡πÄ‡∏õ‡πá‡∏ô Tier 2 (‡∏ö‡∏±‡∏ï‡∏£ ‡∏õ‡∏ä‡∏ä.) ‡∏´‡∏£‡∏∑‡∏≠ Tier 3 (NDID)
    - **Body:** `{ "tier": "TIER_2", "national_id": "...", "id_card_image": "base64/url" }`

*Note:* ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡πà‡∏≠‡∏ô‡πÑ‡∏´‡∏ß‡∏ï‡πâ‡∏≠‡∏á‡∏ñ‡∏π‡∏Å Encrypt ‡∏Å‡πà‡∏≠‡∏ô‡∏•‡∏á DB.

---

### 2. Transaction Module (‡∏´‡∏±‡∏ß‡πÉ‡∏à‡∏´‡∏•‡∏±‡∏Å)

*‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ß‡∏á‡∏à‡∏£‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï‡∏Å‡∏≤‡∏£‡∏ã‡∏∑‡πâ‡∏≠‡∏Ç‡∏≤‡∏¢ ‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏ï‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏à‡∏ô‡∏ñ‡∏∂‡∏á‡∏à‡∏ö‡∏á‡∏≤‡∏ô*

- **`POST /transactions`**
    
    **‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà:** ‡∏ú‡∏π‡πâ‡∏Ç‡∏≤‡∏¢ (Seller) ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢
    
    - **Body:**

```json
{
  "product_name": "iPhone 15 Pro Max",
  "description": "Used, 99% Battery",
  "amount": 35000.00,
  "seller_contact": "081-xxxxxxx"
}
```

- **Response:** ‡∏™‡∏£‡πâ‡∏≤‡∏á `TXID` ‡πÅ‡∏•‡∏∞ `PIN` (6 ‡∏´‡∏•‡∏±‡∏Å) ‡∏Ñ‡∏∑‡∏ô‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤ ‡∏û‡∏£‡πâ‡∏≠‡∏° `payment_link` ‡πÅ‡∏•‡∏∞ `tracking_link`.
- **`GET /transactions/{txid}`**
    - **‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà:** ‡∏î‡∏π‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ò‡∏∏‡∏£‡∏Å‡∏£‡∏£‡∏° (‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ‡∏ó‡∏±‡πâ‡∏á‡∏Ñ‡∏ô‡∏ã‡∏∑‡πâ‡∏≠/‡∏Ñ‡∏ô‡∏Ç‡∏≤‡∏¢)
    - **Header:** `X-Transaction-PIN: <6-digit-pin>` (‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ PIN ‡∏ñ‡∏∂‡∏á‡∏à‡∏∞‡∏î‡∏π‡πÑ‡∏î‡πâ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢)

**Response:** Status (`CREATED`, `PAID`, `SHIPPED`), Product Info, Tracking Number.

- **`POST /transactions/{txid}/confirm-receipt`**
    
    **‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà:** ‡∏ú‡∏π‡πâ‡∏ã‡∏∑‡πâ‡∏≠‡∏Å‡∏î‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏£‡∏±‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ (Happy Path)
    
    - **Logic:**
        1. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ User ‡∏Ñ‡∏∑‡∏≠ Buyer ‡∏ï‡∏±‡∏ß‡∏à‡∏£‡∏¥‡∏á
        2. ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô Status ‡πÄ‡∏õ‡πá‡∏ô `COMPLETED`
        3. Trigger ‡∏£‡∏∞‡∏ö‡∏ö **Auto-Release** ‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡πÉ‡∏´‡πâ‡∏ú‡∏π‡πâ‡∏Ç‡∏≤‡∏¢‡∏ó‡∏±‡∏ô‡∏ó‡∏µ

---

### 3. Payment & Webhook Module (‡∏™‡πà‡∏ß‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô)

*‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£‡πÅ‡∏•‡∏∞‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Ledger (‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏Ñ‡∏π‡πà)*

- **`POST /webhooks/bank/callback`** (Critical Security!)
    - **‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà:** ‡∏£‡∏±‡∏ö‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏à‡∏≤‡∏Å‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤ (QR Payment)
    - **Header:** `X-Bank-Signature` (‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô‡∏î‡∏¥‡∏à‡∏¥‡∏ó‡∏±‡∏•‡∏ß‡πà‡∏≤‡∏°‡∏≤‡∏à‡∏≤‡∏Å‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£‡∏à‡∏£‡∏¥‡∏á ‡∏´‡πâ‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏°)
    - **Body:** `{ "ref_id": "TX-xxxx", "amount": 35000.00, "status": "SUCCESS", "timestamp": "..." }`
    - **Logic:**
        1. Verify Signature
        2. Check Idempotency (‡∏ñ‡πâ‡∏≤‡πÄ‡∏Ñ‡∏¢‡∏£‡∏±‡∏ö‡πÅ‡∏•‡πâ‡∏ß ‡πÉ‡∏´‡πâ‡∏Ç‡πâ‡∏≤‡∏°)
        3. ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å Ledger: Debit `Bank`, Credit `Escrow Liability`
        4. Update Transaction Status -> `PAID`
- **`GET /payment/qr/{txid}`**

**‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà:** Gen QR Code ‡πÅ‡∏ö‡∏ö Dynamic ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÉ‡∏´‡πâ‡∏ú‡∏π‡πâ‡∏ã‡∏∑‡πâ‡∏≠‡∏™‡πÅ‡∏Å‡∏ô‡∏à‡πà‡∏≤‡∏¢

---

### 4. Shipment Module (‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏°‡∏≠‡∏ö)

*‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Tracking ‡πÅ‡∏•‡∏∞‡∏ô‡∏±‡∏ö‡πÄ‡∏ß‡∏•‡∏≤ Auto-Release*

- **`POST /transactions/{txid}/shipment`**
    - **‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà:** ‡∏ú‡∏π‡πâ‡∏Ç‡∏≤‡∏¢‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏•‡∏Ç‡∏û‡∏±‡∏™‡∏î‡∏∏
    - **Body:**

```json
{
  "courier": "Kerry",
  "tracking_number": "KER123456789",
  "seller_bank_account": "encrypted_data", // ‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô (‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡∏´‡∏±‡∏™)
  "seller_bank_name": "KBANK"
}
```

**Logic:**

1. ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô Status -> `SHIPPED`
2. ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ `auto_release_at` = `Now() + 48 Hours` (‡∏ï‡∏≤‡∏°‡∏Å‡∏é 48 ‡∏ä‡∏°.)

---

### 5. Dispute Module (‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏û‡∏¥‡∏û‡∏≤‡∏ó)

*Exception Path ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Ç‡∏≠‡∏á‡∏°‡∏µ‡∏õ‡∏±‡∏ç‡∏´‡∏≤*

- **`POST /transactions/{txid}/dispute`**
    
    **‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà:** ‡∏ú‡∏π‡πâ‡∏ã‡∏∑‡πâ‡∏≠‡πÄ‡∏õ‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏û‡∏¥‡∏û‡∏≤‡∏ó (‡∏ï‡πâ‡∏≠‡∏á‡∏ó‡∏≥‡∏†‡∏≤‡∏¢‡πÉ‡∏ô 48 ‡∏ä‡∏°. ‡∏´‡∏•‡∏±‡∏á‡∏Ç‡∏≠‡∏á‡∏ñ‡∏∂‡∏á)
    
    - **Body:** `{ "reason": "ITEM_MISMATCH", "description": "...", "evidence_images": ["url1", "url2"] }`
    - **Logic:**
        1. ‡∏´‡∏¢‡∏∏‡∏î‡πÄ‡∏ß‡∏•‡∏≤ Auto-Release ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ (Freeze Money)
        2. ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô Status -> `DISPUTE`
        3. ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô Admin ‡πÅ‡∏•‡∏∞‡∏ú‡∏π‡πâ‡∏Ç‡∏≤‡∏¢

---

## Steve's Technical Note (‡∏à‡∏∏‡∏î‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏∞‡∏ß‡∏±‡∏á‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô Code)

1. **Rate Limiting:** API ‡∏ù‡∏±‡πà‡∏á Public (‡πÄ‡∏ä‡πà‡∏ô `GET /transactions/{txid}` ‡∏´‡∏£‡∏∑‡∏≠ `POST /auth/otp`) ‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏™‡πà Rate Limit (‡πÄ‡∏ä‡πà‡∏ô 10 req/min) ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏∏‡πà‡∏° PIN ‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏¥‡∏á SMS ‡πÄ‡∏õ‡∏•‡∏∑‡∏≠‡∏á‡∏á‡∏ö
2. **Input Validation (Pydantic):** ‡πÉ‡∏ô FastAPI ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô Model ‡πÉ‡∏´‡πâ‡∏£‡∏±‡∏î‡∏Å‡∏∏‡∏° ‡πÄ‡∏ä‡πà‡∏ô `amount` ‡∏´‡πâ‡∏≤‡∏°‡∏ï‡∏¥‡∏î‡∏•‡∏ö, `tracking_number` ‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏≠‡∏±‡∏Å‡∏Ç‡∏£‡∏∞‡∏û‡∏¥‡πÄ‡∏®‡∏©‡πÅ‡∏õ‡∏•‡∏Å‡∏õ‡∏•‡∏≠‡∏°
3. **Database Transaction:** ‡πÉ‡∏ô Endpoint `confirm-receipt` ‡πÅ‡∏•‡∏∞ `webhook` ‡∏Å‡∏≤‡∏£ Update ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å Ledger ‡∏ï‡πâ‡∏≠‡∏á‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô `db.transaction()` ‡∏Å‡πâ‡∏≠‡∏ô‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô ‡∏ñ‡πâ‡∏≤‡∏û‡∏±‡∏á‡∏ï‡πâ‡∏≠‡∏á Rollback ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î

**"Logic Flow ‡∏Ç‡∏≠‡∏á‡∏£‡∏∞‡∏ö‡∏ö Auto-Release ‡πÅ‡∏•‡∏∞ Webhook"**  ‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏ï‡πâ‡∏≠‡∏á‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á Time-based trigger (48 ‡∏ä‡∏°.) ‡πÅ‡∏•‡∏∞‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô Race Condition Schema ‡∏ô‡∏µ‡πâ‡∏ñ‡∏π‡∏Å‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö‡πÉ‡∏´‡πâ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö **Financial Integrity** (‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô), **Security** (‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏≤‡∏° PDPA), ‡πÅ‡∏•‡∏∞ **Scalability** (‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö Transaction ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏°‡∏≤‡∏Å) ‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á‡∏ï‡∏≤‡∏° Business Logic ‡πÉ‡∏ô‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡πÅ‡∏ú‡∏ô‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à

---

---

## Depayit Production Database Schema (SQL)

‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ô‡∏≥ Code ‡∏ä‡∏∏‡∏î‡∏ô‡∏µ‡πâ‡πÑ‡∏õ‡∏£‡∏±‡∏ô‡πÉ‡∏ô Supabase ‡∏´‡∏£‡∏∑‡∏≠ AWS RDS (PostgreSQL) 

```sql
-- 1. Enable UUID Extension (‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ UUID ‡πÅ‡∏ó‡∏ô ID ‡∏ó‡∏µ‡πà‡πÄ‡∏î‡∏≤‡∏á‡πà‡∏≤‡∏¢)
CREATE EXTENSION IF NOT EXISTS "uuid-ossp";

-- ==========================================
-- 1. USERS & AUTHENTICATION (‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ User ‡πÅ‡∏•‡∏∞ KYC)
-- ==========================================
CREATE TYPE user_role AS ENUM ('BUYER', 'SELLER', 'ADMIN', 'SUPPORT');
CREATE TYPE kyc_tier_level AS ENUM ('TIER_1', 'TIER_2', 'TIER_3');

CREATE TABLE users (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    phone_number VARCHAR(20) UNIQUE NOT NULL, -- ‡πÉ‡∏ä‡πâ‡πÄ‡∏õ‡πá‡∏ô ID ‡∏´‡∏•‡∏±‡∏Å‡πÉ‡∏ô‡∏Å‡∏≤‡∏£ Login
    email VARCHAR(255) UNIQUE,
    password_hash VARCHAR(255) NOT NULL, -- ‡πÄ‡∏Å‡πá‡∏ö‡πÅ‡∏ö‡∏ö Argon2 ‡∏´‡∏£‡∏∑‡∏≠ Bcrypt
    full_name VARCHAR(100),
    
    [cite_start]-- KYC & Risk Control [cite: 83, 87]
    kyc_tier kyc_tier_level DEFAULT 'TIER_1',
    kyc_status VARCHAR(20) DEFAULT 'PENDING', -- PENDING, VERIFIED, REJECTED
    [cite_start]trust_score INT DEFAULT 100, -- ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ô‡πà‡∏≤‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏ñ‡∏∑‡∏≠ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô 100 [cite: 87]
    [cite_start]is_blacklisted BOOLEAN DEFAULT FALSE, -- ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏ö‡∏ô User ‡∏ó‡∏µ‡πà‡πÇ‡∏Å‡∏á [cite: 87]
    
    -- PDPA Consent Logs
    pdpa_accepted_at TIMESTAMP,
    
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP
);

-- ==========================================
-- 2. TRANSACTIONS (‡∏´‡∏±‡∏ß‡πÉ‡∏à‡∏´‡∏•‡∏±‡∏Å‡∏Ç‡∏≠‡∏á‡∏£‡∏∞‡∏ö‡∏ö)
-- ==========================================
CREATE TYPE transaction_status AS ENUM (
    'CREATED',           -- ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÅ‡∏•‡πâ‡∏ß ‡∏£‡∏≠‡∏Ñ‡∏ô‡∏ã‡∏∑‡πâ‡∏≠
    'WAITING_PAYMENT',   -- ‡∏ú‡∏π‡πâ‡∏ã‡∏∑‡πâ‡∏≠‡∏Å‡∏î‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÅ‡∏•‡πâ‡∏ß ‡∏£‡∏≠‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô
    'PAID',              -- ‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤ Escrow ‡πÅ‡∏•‡πâ‡∏ß (‡∏£‡∏≠‡∏™‡πà‡∏á)
    'SHIPPED',           -- ‡∏ú‡∏π‡πâ‡∏Ç‡∏≤‡∏¢‡πÅ‡∏à‡πâ‡∏á‡∏™‡πà‡∏á‡∏Ç‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ß (‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ô‡∏±‡∏ö 48 ‡∏ä‡∏°.)
    'COMPLETED',         -- ‡∏ú‡∏π‡πâ‡∏ã‡∏∑‡πâ‡∏≠‡∏£‡∏±‡∏ö‡∏Ç‡∏≠‡∏á ‡∏´‡∏£‡∏∑‡∏≠ Auto-Release ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô
    [cite_start]'DISPUTE',           -- ‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏û‡∏¥‡∏û‡∏≤‡∏ó (‡∏´‡∏¢‡∏∏‡∏î‡πÄ‡∏ß‡∏•‡∏≤ Auto-Release) [cite: 85]
    'REFUNDED',          -- ‡∏Ñ‡∏∑‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏ú‡∏π‡πâ‡∏ã‡∏∑‡πâ‡∏≠
    'CANCELLED'          -- ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡πà‡∏≠‡∏ô‡πÇ‡∏≠‡∏ô/‡∏™‡πà‡∏á
);

CREATE TABLE transactions (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    
    -- Public ID ‡∏ó‡∏µ‡πà‡πÅ‡∏ä‡∏£‡πå‡πÑ‡∏î‡πâ (‡πÄ‡∏ä‡πà‡∏ô TX-202505-ABC)
    txid VARCHAR(20) UNIQUE NOT NULL,
    
    [cite_start]-- Security: PIN 6 ‡∏´‡∏•‡∏±‡∏Å ‡∏ï‡πâ‡∏≠‡∏á Hash ‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô [cite: 43]
    pin_hash VARCHAR(255) NOT NULL,
    
    -- Relations
    seller_id UUID REFERENCES users(id),
    buyer_id UUID REFERENCES users(id), -- ‡πÄ‡∏õ‡πá‡∏ô NULL ‡πÑ‡∏î‡πâ‡∏ï‡∏≠‡∏ô‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÅ‡∏£‡∏Å
    
    -- Product Details
    product_name VARCHAR(255) NOT NULL,
    product_description TEXT,
    product_price NUMERIC(18, 2) NOT NULL CHECK (product_price > 0),
    
    -- Fees Calculation (‡πÅ‡∏¢‡∏Å‡πÉ‡∏´‡πâ‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ö‡∏±‡∏ç‡∏ä‡∏µ)
    [cite_start]platform_fee NUMERIC(18, 2) NOT NULL DEFAULT 0, -- 1.5-3% [cite: 48, 105]
    net_amount NUMERIC(18, 2) NOT NULL, -- ‡∏¢‡∏≠‡∏î‡∏ó‡∏µ‡πà‡∏ú‡∏π‡πâ‡∏Ç‡∏≤‡∏¢‡∏à‡∏∞‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö (Price - Fee)
    
    status transaction_status DEFAULT 'CREATED',
    
    [cite_start]-- Auto-Release Logic [cite: 82, 84]
    shipped_at TIMESTAMP WITH TIME ZONE,
    auto_release_at TIMESTAMP WITH TIME ZONE, -- ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å set ‡πÄ‡∏°‡∏∑‡πà‡∏≠ status = SHIPPED (Now + 48h)
    
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP
);

-- Index ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÅ‡∏•‡∏∞ Auto-Release Worker
CREATE INDEX idx_transactions_txid ON transactions(txid);
CREATE INDEX idx_transactions_status_auto_release ON transactions(status, auto_release_at);

-- ==========================================
-- 3. SHIPMENTS (‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏™‡πà‡∏á)
-- ==========================================
CREATE TABLE shipments (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    transaction_id UUID UNIQUE REFERENCES transactions(id),
    
    courier_name VARCHAR(50) NOT NULL, -- Kerry, Flash, ThaiPost
    tracking_number VARCHAR(100) NOT NULL,
    
    [cite_start]-- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡∏Ç‡∏≤‡∏¢ (Sensitive Data - ‡∏ï‡πâ‡∏≠‡∏á Encrypt!) [cite: 82]
    -- ‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏õ‡πá‡∏ô Text ‡∏ó‡∏µ‡πà‡∏ú‡πà‡∏≤‡∏ô‡∏Å‡∏≤‡∏£ Encrypt ‡∏à‡∏≤‡∏Å App Layer ‡πÅ‡∏•‡πâ‡∏ß
    encrypted_seller_bank_acc TEXT NOT NULL, 
    seller_bank_name VARCHAR(50) NOT NULL,
    
    shipping_proof_url TEXT, -- ‡∏£‡∏π‡∏õ‡∏ñ‡πà‡∏≤‡∏¢‡πÉ‡∏ö‡πÄ‡∏™‡∏£‡πá‡∏à/‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏û‡∏±‡∏™‡∏î‡∏∏
    
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP
);

-- ==========================================
-- 4. LEDGER (‡∏£‡∏∞‡∏ö‡∏ö‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏Ñ‡∏π‡πà Double-Entry)
-- ==========================================
-- ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ô‡∏µ‡πâ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Fintech ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏´‡∏≤‡∏¢
CREATE TYPE account_type AS ENUM (
    [cite_start]'ASSET_CASHFLOW_BANK',  -- ‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î‡πÉ‡∏ô‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó (‡∏™‡∏¥‡∏ô‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå) [cite: 40]
    'LIABILITY_ESCROW',     -- ‡∏´‡∏ô‡∏µ‡πâ‡∏™‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏à‡πà‡∏≤‡∏¢‡∏Ñ‡∏∑‡∏ô‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ (‡∏´‡∏ô‡∏µ‡πâ‡∏™‡∏¥‡∏ô)
    'REVENUE_FEE',          -- ‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏Ñ‡πà‡∏≤‡∏ò‡∏£‡∏£‡∏°‡πÄ‡∏ô‡∏µ‡∏¢‡∏° (‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ)
    'EXPENSE_GATEWAY'       -- ‡∏Ñ‡πà‡∏≤‡∏ò‡∏£‡∏£‡∏°‡πÄ‡∏ô‡∏µ‡∏¢‡∏°‡∏ó‡∏µ‡πà‡∏à‡πà‡∏≤‡∏¢‡πÉ‡∏´‡πâ Gateway (‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢)
);

CREATE TYPE entry_direction AS ENUM ('DEBIT', 'CREDIT');

CREATE TABLE ledger_entries (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    transaction_id UUID REFERENCES transactions(id),
    
    account account_type NOT NULL,
    direction entry_direction NOT NULL,
    amount NUMERIC(18, 2) NOT NULL CHECK (amount > 0),
    
    balance_snapshot NUMERIC(18, 2), -- ‡∏¢‡∏≠‡∏î‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠ ‡∏ì ‡∏Ç‡∏ì‡∏∞‡∏ô‡∏±‡πâ‡∏ô (Optional ‡πÅ‡∏ï‡πà‡∏î‡∏µ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£ Debug)
    reference_code VARCHAR(100), -- Webhook Ref ID ‡∏´‡∏£‡∏∑‡∏≠ Bank Transaction ID
    
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP
);

-- ==========================================
-- 5. DISPUTES (‡∏£‡∏∞‡∏ö‡∏ö‡∏Ç‡πâ‡∏≠‡∏û‡∏¥‡∏û‡∏≤‡∏ó)
-- ==========================================
CREATE TYPE dispute_status AS ENUM ('OPEN', 'UNDER_REVIEW', 'RESOLVED_REFUND', 'RESOLVED_RELEASE');

CREATE TABLE disputes (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    transaction_id UUID REFERENCES transactions(id),
    opener_id UUID REFERENCES users(id), -- ‡πÉ‡∏Ñ‡∏£‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏ô‡πÄ‡∏õ‡∏¥‡∏î (‡∏õ‡∏Å‡∏ï‡∏¥‡∏Ñ‡∏∑‡∏≠ Buyer)
    
    reason VARCHAR(50) NOT NULL, -- ITEM_NOT_RECEIVED, DAMAGED, FAKE
    description TEXT,
    
    status dispute_status DEFAULT 'OPEN',
    admin_comment TEXT,
    
    resolved_at TIMESTAMP WITH TIME ZONE,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE dispute_evidence (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    dispute_id UUID REFERENCES disputes(id),
    uploader_id UUID REFERENCES users(id),
    [cite_start]file_url TEXT NOT NULL, -- ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô [cite: 86]
    description TEXT,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP
);

-- ==========================================
-- 6. AUDIT LOGS (‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢ Triple Control)
-- ==========================================
[cite_start]-- ‡πÄ‡∏Å‡πá‡∏ö Log ‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏ó‡∏≥‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç ‡πÇ‡∏î‡∏¢‡πÄ‡∏â‡∏û‡∏≤‡∏∞ Admin ‡∏ó‡∏µ‡πà‡∏°‡∏≤‡∏¢‡∏∏‡πà‡∏á‡∏Å‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô [cite: 40, 41]
CREATE TABLE audit_logs (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    actor_id UUID REFERENCES users(id), -- Admin ‡∏Ñ‡∏ô‡πÑ‡∏´‡∏ô‡∏ó‡∏≥
    action VARCHAR(100) NOT NULL, -- ‡πÄ‡∏ä‡πà‡∏ô 'FORCE_RELEASE_FUND', 'APPROVE_KYC'
    target_id UUID, -- Transaction ID ‡∏´‡∏£‡∏∑‡∏≠ User ID ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏Å‡∏£‡∏∞‡∏ó‡∏≥
    details JSONB, -- ‡πÄ‡∏Å‡πá‡∏ö‡∏Ñ‡πà‡∏≤‡πÄ‡∏Å‡πà‡∏≤/‡∏Ñ‡πà‡∏≤‡πÉ‡∏´‡∏°‡πà
    ip_address VARCHAR(45),
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP
);
```

## Steve's CTO Insights (‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÄ‡∏ä‡∏¥‡∏á‡∏•‡∏∂‡∏Å)

1. **‡∏ó‡∏≥‡πÑ‡∏°‡∏ï‡πâ‡∏≠‡∏á `NUMERIC(18, 2)`?**
    - ‡∏´‡πâ‡∏≤‡∏°‡πÉ‡∏ä‡πâ `FLOAT` ‡∏´‡∏£‡∏∑‡∏≠ `DOUBLE` ‡∏Å‡∏±‡∏ö‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡πá‡∏î‡∏Ç‡∏≤‡∏î‡∏Ñ‡∏£‡∏±‡∏ö ‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏°‡∏±‡∏ô‡∏°‡∏µ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏ó‡∏®‡∏ô‡∏¥‡∏¢‡∏°‡πÄ‡∏û‡∏µ‡πâ‡∏¢‡∏ô (Floating Point Error) ‡πÄ‡∏ä‡πà‡∏ô 0.1 + 0.2 ‡∏≠‡∏≤‡∏à‡πÑ‡∏î‡πâ 0.30000000000000004 ‡∏ã‡∏∂‡πà‡∏á‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡πÑ‡∏°‡πà‡∏•‡∏á‡∏ï‡∏±‡∏ß
2. **Encryption Strategy (`encrypted_seller_bank_acc`)**:
    - ‡πÅ‡∏°‡πâ‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡πÄ‡∏Å‡πá‡∏ö‡πÉ‡∏ô DB ‡πÅ‡∏ï‡πà‡∏ñ‡πâ‡∏≤ DB ‡∏´‡∏•‡∏∏‡∏î ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢ ‡∏ú‡∏°‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ Library ‡πÉ‡∏ô Python (‡πÄ‡∏ä‡πà‡∏ô `cryptography.fernet`) Encrypt ‡∏°‡∏≤‡∏à‡∏≤‡∏Å Backend ‡∏Å‡πà‡∏≠‡∏ô `INSERT` ‡∏•‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ô‡∏µ‡πâ‡∏Ñ‡∏£‡∏±‡∏ö
3. **Performance Indexing**:
    - ‡∏ú‡∏°‡∏ó‡∏≥ Index ‡πÑ‡∏ß‡πâ‡∏ó‡∏µ‡πà `auto_release_at` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏£‡∏∞‡∏ö‡∏ö Cron Job ‡∏ß‡∏¥‡πà‡∏á‡∏°‡∏≤ query ‡∏´‡∏≤‡πÄ‡∏Ñ‡∏™‡∏ó‡∏µ‡πà‡∏Ñ‡∏£‡∏ö 48 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á‡πÑ‡∏î‡πâ‡πÑ‡∏ß‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î ‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡∏Å‡∏£‡∏∞‡∏ó‡∏ö Transaction ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô

---

## ‚öôÔ∏è Auto-Release Logic Flow (‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡∏£‡∏∞‡∏ö‡∏ö)

‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á **Background Worker** (‡∏´‡∏∏‡πà‡∏ô‡∏¢‡∏ô‡∏ï‡πå‡πÄ‡∏ù‡πâ‡∏≤‡∏ö‡πâ‡∏≤‡∏ô) ‡∏ó‡∏µ‡πà‡∏ï‡∏∑‡πà‡∏ô‡∏°‡∏≤‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ó‡∏∏‡∏Å‡πÜ 1 ‡∏ô‡∏≤‡∏ó‡∏µ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏ä‡πá‡∏Ñ‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏î‡∏±‡∏á‡∏ô‡∏µ‡πâ‡∏Ñ‡∏£‡∏±‡∏ö:

1. **Search:** ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ Transaction ‡∏ó‡∏µ‡πà‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏õ‡πá‡∏ô `SHIPPED` **‡πÅ‡∏•‡∏∞** ‡πÄ‡∏ß‡∏•‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡πÄ‡∏•‡∏¢‡∏Å‡∏≥‡∏´‡∏ô‡∏î `auto_release_at` ‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß
2. **Lock:** "‡∏•‡πá‡∏≠‡∏Å" ‡πÅ‡∏ñ‡∏ß‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡πâ‡∏ô‡πÑ‡∏ß‡πâ‡∏Å‡πà‡∏≠‡∏ô (Database Row Lock) ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ Worker ‡∏ï‡∏±‡∏ß‡∏≠‡∏∑‡πà‡∏ô (‡∏ñ‡πâ‡∏≤‡πÄ‡∏£‡∏≤‡∏°‡∏µ‡∏´‡∏•‡∏≤‡∏¢‡∏ï‡∏±‡∏ß) ‡∏°‡∏≤‡πÅ‡∏¢‡πà‡∏á‡∏Å‡∏±‡∏ô‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ã‡πâ‡∏≥
3. **Process:**
    - ‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏à‡∏≤‡∏Å‡∏ö‡∏±‡∏ç‡∏ä‡∏µ Escrow -> ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏ú‡∏π‡πâ‡∏Ç‡∏≤‡∏¢ (‡∏ú‡πà‡∏≤‡∏ô Bank API)
    - ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å Ledger (‡∏™‡∏°‡∏∏‡∏î‡∏ö‡∏±‡∏ç‡∏ä‡∏µ) ‡∏ß‡πà‡∏≤ "‡∏´‡∏ô‡∏µ‡πâ‡∏™‡∏¥‡∏ô‡∏•‡∏î‡∏•‡∏á" ‡πÅ‡∏•‡∏∞ "‡πÄ‡∏á‡∏¥‡∏ô‡πÉ‡∏ô‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£‡∏•‡∏î‡∏•‡∏á"
4. **Update:** ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏õ‡πá‡∏ô `COMPLETED`
5. **Log:** ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å Audit Log ‡∏ß‡πà‡∏≤ "‡∏£‡∏∞‡∏ö‡∏ö‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à"

## Python Code: Auto-Release Worker (Production Grade)

‡πÇ‡∏Ñ‡πâ‡∏î‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πâ **Python** ‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏±‡∏ö **SQLAlchemy** (ORM) ‡πÅ‡∏•‡∏∞ **APScheduler** (‡∏ï‡∏±‡∏ß‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏ß‡∏•‡∏≤) ‡∏ã‡∏∂‡πà‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏±‡∏ô‡πÑ‡∏î‡πâ‡∏î‡∏µ‡∏Å‡∏±‡∏ö Stack FastAPI ‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏≤‡∏Ñ‡∏£‡∏±‡∏ö

## Steve's CTO Advice: ‡∏à‡∏∏‡∏î‡∏ï‡∏≤‡∏¢‡∏ó‡∏µ‡πà‡∏´‡πâ‡∏≤‡∏°‡∏û‡∏•‡∏≤‡∏î

1. **Concurrency Control (`FOR UPDATE SKIP LOCKED`)**: ‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï‡πÉ‡∏ô Code SQL ‡∏ô‡∏∞‡∏Ñ‡∏£‡∏±‡∏ö ‡∏ú‡∏°‡πÉ‡∏™‡πà‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ô‡∏µ‡πâ‡πÑ‡∏ß‡πâ ‡∏ô‡∏µ‡πà‡∏Ñ‡∏∑‡∏≠ **Super Power** ‡∏Ç‡∏≠‡∏á PostgreSQL ‡∏Ñ‡∏£‡∏±‡∏ö ‡∏°‡∏±‡∏ô‡∏ä‡πà‡∏ß‡∏¢‡πÉ‡∏´‡πâ‡πÄ‡∏£‡∏≤‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏£‡∏±‡∏ô Worker ‡∏ï‡∏±‡∏ß‡∏ô‡∏µ‡πâ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡∏±‡∏ô‡∏´‡∏•‡∏≤‡∏¢‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÑ‡∏î‡πâ (Scalability) ‡πÇ‡∏î‡∏¢‡∏ó‡∏µ‡πà‡∏û‡∏ß‡∏Å‡∏°‡∏±‡∏ô‡∏à‡∏∞‡πÑ‡∏°‡πà‡πÅ‡∏¢‡πà‡∏á‡∏á‡∏≤‡∏ô‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô‡∏ó‡∏≥ (‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏•‡∏±‡∏ß‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏ö‡∏¥‡πâ‡∏• 2 ‡∏£‡∏≠‡∏ö)

```python
import logging
from datetime import datetime
from sqlalchemy import create_engine, text
from sqlalchemy.orm import sessionmaker
from apscheduler.schedulers.blocking import BlockingScheduler

# Config Setup
DATABASE_URL = "postgresql://user:password@localhost:5432/depayit_db"
engine = create_engine(DATABASE_URL)
SessionLocal = sessionmaker(bind=engine)

# Logging Setup (‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏°‡∏≤‡∏Å‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Fintech)
logging.basicConfig(level=logging.INFO, format='%(asctime)s - %(name)s - %(levelname)s - %(message)s')
logger = logging.getLogger("AutoReleaseWorker")

def process_auto_release():
    """
    ‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à: ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÄ‡∏Ñ‡∏™‡∏ó‡∏µ‡πà‡∏Ñ‡∏£‡∏ö 48 ‡∏ä‡∏°. ‡πÅ‡∏•‡∏∞‡∏™‡∏±‡πà‡∏á‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô
    """
    session = SessionLocal()
    try:
        logger.info("ü§ñ Worker Waking up: Checking for due transactions...")

        # 1. SEARCH & LOCK (SELECT ... FOR UPDATE SKIP LOCKED)
        # ‡πÉ‡∏ä‡πâ SKIP LOCKED ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ Worker ‡∏´‡∏•‡∏≤‡∏¢‡∏ï‡∏±‡∏ß ‡∏ï‡∏±‡∏ß‡πÑ‡∏´‡∏ô‡∏´‡∏¢‡∏¥‡∏ö‡∏á‡∏≤‡∏ô‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß ‡∏ï‡∏±‡∏ß‡∏≠‡∏∑‡πà‡∏ô‡∏à‡∏∞‡∏Ç‡πâ‡∏≤‡∏°‡πÑ‡∏õ‡πÄ‡∏•‡∏¢ ‡πÑ‡∏°‡πà‡πÅ‡∏¢‡πà‡∏á‡∏Å‡∏±‡∏ô
        query = text("""
            SELECT id, amount, seller_id, txid 
            FROM transactions 
            WHERE status = 'SHIPPED' 
              AND auto_release_at <= NOW()
            FOR UPDATE SKIP LOCKED
        """)
        
        due_transactions = session.execute(query).fetchall()

        if not due_transactions:
            logger.info("‚úÖ No due transactions found. Going back to sleep.")
            return

        for tx in due_transactions:
            logger.info(f"‚è≥ Processing TXID: {tx.txid} | Amount: {tx.amount}")

            try:
                # ---------------------------------------------------
                # STEP 2: Execute Transfer (Call Bank API)
                # ---------------------------------------------------
                # ‡πÉ‡∏ô Production ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡∏¢‡∏¥‡∏á API ‡πÑ‡∏õ‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£ (‡πÄ‡∏ä‡πà‡∏ô KBANK/SCB)
                # bank_response = bank_client.transfer(to=tx.seller_id, amount=tx.amount)
                
                # Mock Success for MVP
                bank_transfer_success = True 
                
                if bank_transfer_success:
                    # ---------------------------------------------------
                    # STEP 3: Update Ledger (Double Entry)
                    # ---------------------------------------------------
                    # 3.1 Debit Liability (‡∏•‡πâ‡∏≤‡∏á‡∏´‡∏ô‡∏µ‡πâ‡∏™‡∏¥‡∏ô Escrow)
                    session.execute(text("""
                        INSERT INTO ledger_entries (transaction_id, account, direction, amount, reference_code)
                        VALUES (:tx_id, 'LIABILITY_ESCROW', 'DEBIT', :amount, 'AUTO-RELEASE')
                    """), {"tx_id": tx.id, "amount": tx.amount})

                    # 3.2 Credit Bank (‡πÄ‡∏á‡∏¥‡∏ô‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó)
                    session.execute(text("""
                        INSERT INTO ledger_entries (transaction_id, account, direction, amount, reference_code)
                        VALUES (:tx_id, 'ASSET_CASHFLOW_BANK', 'CREDIT', :amount, 'AUTO-RELEASE')
                    """), {"tx_id": tx.id, "amount": tx.amount})

                    # ---------------------------------------------------
                    # STEP 4: Update Transaction Status
                    # ---------------------------------------------------
                    session.execute(text("""
                        UPDATE transactions 
                        SET status = 'COMPLETED', updated_at = NOW() 
                        WHERE id = :tx_id
                    """), {"tx_id": tx.id})
                    
                    # ---------------------------------------------------
                    # STEP 5: Audit Log
                    # ---------------------------------------------------
                    session.execute(text("""
                        INSERT INTO audit_logs (action, target_id, details)
                        VALUES ('AUTO_RELEASE_SUCCESS', :tx_id, '{"reason": "48h_timeout"}')
                    """), {"tx_id": tx.id})

                    # Commit per transaction (‡∏ñ‡πâ‡∏≤‡∏û‡∏±‡∏á 1 ‡πÄ‡∏Ñ‡∏™ ‡πÄ‡∏Ñ‡∏™‡∏≠‡∏∑‡πà‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏°‡πà‡∏û‡∏±‡∏á‡∏ï‡∏≤‡∏°)
                    session.commit()
                    logger.info(f"‚úÖ Released funds for TXID: {tx.txid} successfully.")
                
            except Exception as e:
                session.rollback() # ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÄ‡∏Ñ‡∏™‡∏ô‡∏µ‡πâ‡∏ñ‡πâ‡∏≤‡∏û‡∏±‡∏á
                logger.error(f"‚ùå Error processing TXID {tx.txid}: {str(e)}")
                # ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ‡∏Ñ‡∏ß‡∏£‡∏™‡πà‡∏á Alert ‡πÄ‡∏Ç‡πâ‡∏≤ Line/Slack ‡∏Ç‡∏≠‡∏á Dev ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ

    except Exception as e:
        logger.critical(f"üî• Critical Worker Error: {str(e)}")
    finally:
        session.close()

# Start Scheduler
if __name__ == "__main__":
    scheduler = BlockingScheduler()
    # ‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡πÉ‡∏´‡πâ‡∏£‡∏±‡∏ô‡∏ó‡∏∏‡∏Å‡πÜ 1 ‡∏ô‡∏≤‡∏ó‡∏µ
    scheduler.add_job(process_auto_release, 'interval', minutes=1)
    
    print("üöÄ Depayit Auto-Release Worker Started...")
    try:
        scheduler.start()
    except (KeyboardInterrupt, SystemExit):
        pass
```

1. **Transaction Isolation**: ‡∏™‡∏±‡πà‡∏á `session.commit()` ‡∏ó‡∏µ‡∏•‡∏∞ Transaction (‡πÉ‡∏ô Loop) ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏£‡∏≠‡∏ó‡∏≥‡∏´‡∏°‡∏î‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡πà‡∏≠‡∏¢ Commit ‡∏ó‡∏µ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß ‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏ñ‡πâ‡∏≤‡∏°‡∏µ 100 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡πâ‡∏ß‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà 99 ‡∏û‡∏±‡∏á ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡πÑ‡∏°‡πà‡∏≠‡∏¢‡∏≤‡∏Å‡πÉ‡∏´‡πâ 98 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏£‡∏Å‡πÇ‡∏î‡∏ô‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
2. **Alerting**: ‡πÉ‡∏ô block `except` ‡∏Ç‡∏≠‡∏á‡∏à‡∏£‡∏¥‡∏á ‡∏ú‡∏°‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏´‡πâ‡πÉ‡∏™‡πà Code ‡∏¢‡∏¥‡∏á Notification ‡πÄ‡∏Ç‡πâ‡∏≤ **Slack** ‡∏´‡∏£‡∏∑‡∏≠ **Line Group** ‡∏Ç‡∏≠‡∏á‡∏ó‡∏µ‡∏° Dev ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡∏ó‡∏µ‡πà‡πÇ‡∏≠‡∏ô‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÄ‡∏á‡∏¥‡∏ô‡∏£‡∏≠‡∏ô‡∏≤‡∏ô‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ

---

## üõë Dispute Handling Logic (The Kill Switch)

‡∏´‡∏±‡∏ß‡πÉ‡∏à‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏ó‡∏≤‡∏á‡πÄ‡∏ó‡∏Ñ‡∏ô‡∏¥‡∏Ñ‡∏Ñ‡∏∑‡∏≠: **"‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô Status ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡∏†‡∏≤‡∏¢‡πÉ‡∏ô Transaction ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß"**

‡πÄ‡∏°‡∏∑‡πà‡∏≠ Status ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏à‡∏≤‡∏Å `SHIPPED` ‡πÄ‡∏õ‡πá‡∏ô `DISPUTE`:

1. **Auto-Release Worker** ‡∏à‡∏∞‡∏°‡∏≠‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏´‡πá‡∏ô Transaction ‡∏ô‡∏µ‡πâ‡∏≠‡∏µ‡∏Å‡∏ï‡πà‡∏≠‡πÑ‡∏õ (‡πÄ‡∏û‡∏£‡∏≤‡∏∞ Query `WHERE status = 'SHIPPED'`)
2. ‡πÄ‡∏á‡∏¥‡∏ô‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÅ‡∏ä‡πà‡πÅ‡∏Ç‡πá‡∏á‡πÉ‡∏ô‡∏ö‡∏±‡∏ç‡∏ä‡∏µ Escrow (Liability) ‡∏à‡∏ô‡∏Å‡∏ß‡πà‡∏≤ Admin ‡∏à‡∏∞‡∏ï‡∏±‡∏î‡∏™‡∏¥‡∏ô

---

## üíª Python Code: Dispute API Endpoint

‡∏ô‡∏µ‡πà‡∏Ñ‡∏∑‡∏≠ Code ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö **API `POST /dispute`** ‡∏ó‡∏µ‡πà‡∏ú‡∏π‡πâ‡∏ã‡∏∑‡πâ‡∏≠‡πÉ‡∏ä‡πâ‡∏Å‡∏î‡πÄ‡∏õ‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏û‡∏¥‡∏û‡∏≤‡∏ó‡∏Ñ‡∏£‡∏±‡∏ö ‡πÄ‡∏£‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡πÉ‡∏´‡πâ Thread-Safe ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î

```python
from fastapi import APIRouter, Depends, HTTPException, status
from sqlalchemy.orm import Session
from sqlalchemy import text
from datetime import datetime
# (‡∏™‡∏°‡∏°‡∏ï‡∏¥‡∏ß‡πà‡∏≤ import schemas ‡πÅ‡∏•‡∏∞ models ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß)

router = APIRouter()

@router.post("/transactions/{txid}/dispute")
def create_dispute(
    txid: str, 
    request: DisputeCreateRequest, 
    current_user: User = Depends(get_current_user), 
    db: Session = Depends(get_db)
):
    """
    ‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà: Freeze ‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏±‡∏ô‡∏ó‡∏µ ‡πÅ‡∏•‡∏∞‡πÄ‡∏õ‡∏¥‡∏î Case ‡πÉ‡∏´‡πâ Admin
    """
    try:
        # ‡πÉ‡∏ä‡πâ Transaction Block ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡∏Ç‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
        with db.begin():
            # 1. LOCK ROW: ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÅ‡∏•‡∏∞‡∏•‡πá‡∏≠‡∏Å‡πÅ‡∏ñ‡∏ß Transaction ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô Auto-Release ‡∏°‡∏≤‡πÅ‡∏¢‡πà‡∏á‡∏ó‡∏≥‡∏á‡∏≤‡∏ô
            # ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏°‡∏≤‡∏Å! ‡πÉ‡∏ä‡πâ FOR UPDATE
            query = text("""
                SELECT id, status, buyer_id, seller_id 
                FROM transactions 
                WHERE txid = :txid 
                FOR UPDATE
            """)
            tx = db.execute(query, {"txid": txid}).fetchone()

            if not tx:
                raise HTTPException(status_code=404, detail="Transaction not found")

            # 2. VALIDATION CHECK
            # ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏ô‡∏ã‡∏∑‡πâ‡∏≠‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÄ‡∏õ‡∏¥‡∏î
            if str(tx.buyer_id) != str(current_user.id):
                raise HTTPException(status_code=403, detail="Only buyer can open dispute")

            # ‡∏ï‡πâ‡∏≠‡∏á‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡∏¥‡∏î‡πÑ‡∏î‡πâ (SHIPPED ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô)
            # ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô COMPLETED ‡πÅ‡∏•‡πâ‡∏ß (‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß) ‡∏à‡∏∞‡πÄ‡∏õ‡∏¥‡∏î‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ
            if tx.status != 'SHIPPED':
                raise HTTPException(
                    status_code=400, 
                    detail=f"Cannot dispute. Current status is {tx.status}"
                )

            # 3. FREEZE MONEY (The Kill Switch)
            # ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô Status ‡πÄ‡∏õ‡πá‡∏ô DISPUTE ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ -> Auto-Release ‡∏à‡∏∞‡∏´‡∏¢‡∏∏‡∏î‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏Å‡∏±‡∏ö‡πÄ‡∏Ñ‡∏™‡∏ô‡∏µ‡πâ‡πÇ‡∏î‡∏¢‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
            db.execute(text("""
                UPDATE transactions 
                SET status = 'DISPUTE', updated_at = NOW()
                WHERE id = :id
            """), {"id": tx.id})

            # 4. CREATE DISPUTE RECORD
            dispute_id = db.execute(text("""
                INSERT INTO disputes (transaction_id, opener_id, reason, description, status)
                VALUES (:tx_id, :opener_id, :reason, :desc, 'OPEN')
                RETURNING id
            """), {
                "tx_id": tx.id,
                "opener_id": current_user.id,
                "reason": request.reason,
                "desc": request.description
            }).scalar()

            # 5. SAVE EVIDENCE (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û)
            if request.evidence_urls:
                for url in request.evidence_urls:
                    db.execute(text("""
                        INSERT INTO dispute_evidence (dispute_id, uploader_id, file_url)
                        VALUES (:dispute_id, :uploader_id, :url)
                    """), {
                        "dispute_id": dispute_id,
                        "uploader_id": current_user.id,
                        "url": url
                    })

            # 6. NOTIFICATION (Logic ‡πÄ‡∏™‡∏£‡∏¥‡∏°)
            # send_notification(to=tx.seller_id, msg="Buyer has opened a dispute!")
            # send_notification(to=ADMIN_CHANNEL, msg="New Dispute created!")

        return {"message": "Dispute opened successfully. Payment frozen.", "dispute_id": dispute_id}

    except Exception as e:
        # ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ Error ‡∏≠‡∏∞‡πÑ‡∏£‡∏Å‡πá‡∏ï‡∏≤‡∏° Transaction ‡∏à‡∏∞ Rollback ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏à‡∏∞‡πÑ‡∏°‡πà‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô
        raise HTTPException(status_code=500, detail=str(e))
```

## Admin Resolution Workflow (‡∏ù‡∏±‡πà‡∏á‡∏´‡∏•‡∏±‡∏á‡∏ö‡πâ‡∏≤‡∏ô)

‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏õ‡πá‡∏ô `DISPUTE` ‡πÅ‡∏•‡πâ‡∏ß ‡πÄ‡∏á‡∏¥‡∏ô‡∏à‡∏∞‡∏Ñ‡πâ‡∏≤‡∏á‡∏≠‡∏¢‡∏π‡πà‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏≤‡∏Ñ‡∏£‡∏±‡∏ö Admin ‡∏à‡∏∞‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤‡∏î‡∏π‡πÉ‡∏ô Dashboard ‡πÅ‡∏•‡∏∞‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡∏ï‡∏±‡∏î‡∏™‡∏¥‡∏ô ‡∏ã‡∏∂‡πà‡∏á‡∏à‡∏∞‡∏°‡∏µ 2 ‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á (Scenario) ‡∏ï‡∏≤‡∏° Business Plan:

## Scenario A: ‡∏Ñ‡∏∑‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏ú‡∏π‡πâ‡∏ã‡∏∑‡πâ‡∏≠ (Refund Buyer)

*‡πÉ‡∏ä‡πâ‡πÄ‡∏°‡∏∑‡πà‡∏≠: ‡∏ú‡∏π‡πâ‡∏ã‡∏∑‡πâ‡∏≠‡∏ä‡∏ô‡∏∞ (‡∏Ç‡∏≠‡∏á‡∏õ‡∏•‡∏≠‡∏°, ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Ç‡∏≠‡∏á)*

1. **API:** `POST /admin/disputes/{id}/resolve-refund`
2. **Logic:**
    - Debit `LIABILITY_ESCROW` (‡∏•‡∏î‡∏´‡∏ô‡∏µ‡πâ‡∏™‡∏¥‡∏ô)
    - Credit `CASHFLOW_BANK` (‡πÄ‡∏á‡∏¥‡∏ô‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡πÄ‡∏£‡∏≤) -> ‡πÇ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏ú‡∏π‡πâ‡∏ã‡∏∑‡πâ‡∏≠
    - Update Transaction Status -> `REFUNDED`
    - Update Dispute Status -> `RESOLVED_REFUND`

## Scenario B: ‡∏õ‡∏•‡πà‡∏≠‡∏¢‡πÄ‡∏á‡∏¥‡∏ô‡πÉ‡∏´‡πâ‡∏ú‡∏π‡πâ‡∏Ç‡∏≤‡∏¢ (Release to Seller)

*‡πÉ‡∏ä‡πâ‡πÄ‡∏°‡∏∑‡πà‡∏≠: ‡∏ú‡∏π‡πâ‡∏Ç‡∏≤‡∏¢‡∏ä‡∏ô‡∏∞ (‡∏ú‡∏π‡πâ‡∏ã‡∏∑‡πâ‡∏≠‡πÅ‡∏Å‡∏•‡πâ‡∏á‡πÄ‡∏õ‡∏¥‡∏î Dispute, ‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏û‡∏≠)*

1. **API:** `POST /admin/disputes/{id}/resolve-release`
2. **Logic:**
    - Debit `LIABILITY_ESCROW`
    - Credit `CASHFLOW_BANK` -> ‡πÇ‡∏≠‡∏ô‡πÑ‡∏õ‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏ú‡∏π‡πâ‡∏Ç‡∏≤‡∏¢ (‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô Auto-Release ‡∏õ‡∏Å‡∏ï‡∏¥)
    - Update Transaction Status -> `COMPLETED`
    - Update Dispute Status -> `RESOLVED_RELEASE`

---

## Steve's CTO Advice: ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏£‡∏£‡∏∞‡∏ß‡∏±‡∏á

1. **‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û (Evidence Storage):**
    - ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô (`file_url`) ‡∏Ñ‡∏ß‡∏£‡πÄ‡∏Å‡πá‡∏ö‡πÉ‡∏ô **AWS S3** ‡πÅ‡∏ö‡∏ö **Private Bucket** ‡πÅ‡∏•‡∏∞‡πÉ‡∏ä‡πâ **Presigned URL** ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏¥‡∏î‡∏î‡∏π ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏õ‡πá‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß (PDPA) ‡∏Ñ‡∏£‡∏±‡∏ö ‡∏≠‡∏¢‡πà‡∏≤‡πÄ‡∏Å‡πá‡∏ö‡∏£‡∏π‡∏õ‡πÉ‡∏ô Server ‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á
2. **Notification System:**
    - ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡∏ó‡∏µ‡πà‡∏°‡∏µ Dispute ‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡πâ‡∏≠‡∏á‡∏¢‡∏¥‡∏á Email ‡∏´‡∏£‡∏∑‡∏≠ SMS ‡πÅ‡∏à‡πâ‡∏á Admin ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ (Critical Alert)
3. **‡∏Å‡∏≤‡∏£‡∏ô‡∏±‡∏ö‡πÄ‡∏ß‡∏•‡∏≤ 48 ‡∏ä‡∏°.:**
    - ‡πÉ‡∏ô `GET /transactions/{txid}` ‡∏Ñ‡∏ß‡∏£‡∏™‡πà‡∏á‡∏Ñ‡πà‡∏≤ `remaining_time_seconds` ‡πÑ‡∏õ‡πÉ‡∏´‡πâ Frontend ‡∏î‡πâ‡∏ß‡∏¢ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÅ‡∏™‡∏î‡∏á Countdown Timer ‡πÉ‡∏´‡πâ‡∏ú‡∏π‡πâ‡∏ã‡∏∑‡πâ‡∏≠‡πÄ‡∏´‡πá‡∏ô‡∏ä‡∏±‡∏î‡πÜ ‡∏ß‡πà‡∏≤ "‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÄ‡∏ß‡∏•‡∏≤‡∏≠‡∏µ‡∏Å ... ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏Å‡∏î Dispute"
    
    | **‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ (Status)** | **‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢** |
    | --- | --- |
    | **CREATED** | ‡∏ú‡∏π‡πâ‡∏Ç‡∏≤‡∏¢‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß |
    | **PAID** | ‡∏£‡∏∞‡∏ö‡∏ö‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡∏ú‡πà‡∏≤‡∏ô Webhook Signature ‡∏à‡∏≤‡∏Å‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£‡πÅ‡∏•‡πâ‡∏ß |
    | **SHIPPED** | ‡∏ú‡∏π‡πâ‡∏Ç‡∏≤‡∏¢‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏•‡∏Ç Tracking ‡πÅ‡∏•‡∏∞‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ô‡∏±‡∏ö‡∏ñ‡∏≠‡∏¢‡∏´‡∏•‡∏±‡∏á 48 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á (Auto-Release) |
    | **COMPLETED** | ‡πÄ‡∏á‡∏¥‡∏ô‡∏ñ‡∏π‡∏Å‡πÇ‡∏≠‡∏ô‡πÉ‡∏´‡πâ‡∏ú‡∏π‡πâ‡∏Ç‡∏≤‡∏¢ (‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏Å‡∏î‡∏£‡∏±‡∏ö‡∏Ç‡∏≠‡∏á‡∏´‡∏£‡∏∑‡∏≠‡∏Ñ‡∏£‡∏ö‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÄ‡∏ß‡∏•‡∏≤) |
    | **DISPUTE** | ‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡∏õ‡∏±‡∏ç‡∏´‡∏≤ ‡πÄ‡∏á‡∏¥‡∏ô‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÅ‡∏ä‡πà‡πÅ‡∏Ç‡πá‡∏á (Freeze) ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏≠ Admin ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö |

---

### Depayit System Architecture (Production Blueprint)

‡πÅ‡∏ú‡∏ô‡∏†‡∏≤‡∏û‡∏ô‡∏µ‡πâ‡πÅ‡∏™‡∏î‡∏á‡∏Å‡∏≤‡∏£‡πÑ‡∏´‡∏•‡∏Ç‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (Data Flow) ‡πÅ‡∏•‡∏∞‡∏≠‡∏á‡∏Ñ‡πå‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡∏£‡∏±‡∏ö

**Master Blueprint"** (‡∏û‡∏¥‡∏°‡∏û‡πå‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß‡∏â‡∏ö‡∏±‡∏ö‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå) ‡∏Ç‡∏≠‡∏á Depayit ‡∏ó‡∏µ‡πà‡∏™‡∏£‡∏∏‡∏õ‡∏ó‡∏∏‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏≤‡∏Ñ‡∏∏‡∏¢‡∏Å‡∏±‡∏ô ‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏ï‡πà‡∏´‡∏ô‡πâ‡∏≤‡∏ö‡πâ‡∏≤‡∏ô‡∏¢‡∏±‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏´‡∏•‡∏±‡∏á‡∏ö‡πâ‡∏≤‡∏ô

```
graph TD
    %% --- CLIENT SIDE ---
    subgraph Client_Side ["üíª Client Side (Frontend)"]
        User((User / Customer))
        Web[("Next.js App\n(Mobile & Web)")]
        Admin[("Admin Dashboard\n(Next.js + RBAC)")]
    end

    User -->|HTTPS / SSL| Cloudflare
    Admin -->|HTTPS / VPN| Cloudflare

    %% --- SECURITY LAYER ---
    subgraph Security_Layer ["üõ°Ô∏è Security & Gateway"]
        Cloudflare["Cloudflare\n(DDoS Protection / WAF)"]
        Gateway["API Gateway / Nginx\n(Rate Limiting / Load Balancer)"]
    end

    Cloudflare --> Gateway

    %% --- BACKEND ---
    subgraph Backend_Services ["üß† Backend (The Brain)"]
        API["FastAPI Server\n(Core Logic / REST API)"]
        Worker["Auto-Release Worker\n(APScheduler / Background Job)"]
        
        API <-->|Tasks| Redis_Q[("Redis Queue\n(Celery/Task Queue)")]
        Worker <-->|Pop Tasks| Redis_Q
    end

    Gateway -->|Forward Req| API

    %% --- DATA LAYER ---
    subgraph Data_Layer ["üóÑÔ∏è Data & Storage (The Vault)"]
        DB[("PostgreSQL\n(Users, Tx, Ledger, Disputes)")]
        Cache[("Redis Cache\n(Session / OTP / Config)")]
        S3[("AWS S3 / Storage\n(Encrypted Slips / Evidence)")]
    end

    API -->|Read/Write| DB
    Worker -->|Read/Write (Locking)| DB
    API -->|Cache| Cache
    API -->|Upload/Get| S3

    %% --- EXTERNAL ---
    subgraph External_Services ["üåê External World"]
        Bank[("Bank API / Payment Gateway\n(QR / Webhook)")]
        SMS[("SMS Gateway\n(OTP)")]
        Logistic[("Logistic API\n(Tracking)")]
    end

    API -->|Verify Webhook| Bank
    API -->|Send OTP| SMS
    API -->|Check Status| Logistic
    Worker -->|Trigger Transfer| Bank
    Bank -.->|Webhook Callback| Gateway
```

---

### üìù ‡∏™‡∏£‡∏∏‡∏õ Tech Stack & Key Features

‡∏ô‡∏µ‡πà‡∏Ñ‡∏∑‡∏≠ "‡∏Ñ‡∏±‡∏°‡∏†‡∏µ‡∏£‡πå" ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ó‡∏µ‡∏° Dev ‡∏Ñ‡∏£‡∏±‡∏ö:

| Layer | Technology | Key Responsibility (‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏´‡∏•‡∏±‡∏Å) |
| --- | --- | --- |
| **Frontend** | **Next.js + TypeScript** | ‡∏ó‡∏≥ SSR ‡πÄ‡∏û‡∏∑‡πà‡∏≠ SEO ‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß, ‡πÉ‡∏ä‡πâ Tailwind CSS ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏ß‡∏¢‡∏á‡∏≤‡∏° |
| **Backend** | **Python (FastAPI)** | ‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡πÄ‡∏£‡πá‡∏ß (Async), ‡∏ó‡∏≥ Data Validation ‡πÅ‡∏Ç‡πá‡∏á‡πÅ‡∏Å‡∏£‡πà‡∏á‡∏î‡πâ‡∏ß‡∏¢ Pydantic |
| **Database** | **PostgreSQL** | ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ò‡∏∏‡∏£‡∏Å‡∏£‡∏£‡∏°, User, ‡πÅ‡∏•‡∏∞ **Double-Entry Ledger (‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏Ñ‡∏π‡πà)** |
| **Caching** | **Redis** | ‡πÄ‡∏Å‡πá‡∏ö Session Login, Rate Limiting (‡∏Å‡∏±‡∏ô‡∏¢‡∏¥‡∏á API ‡∏£‡∏±‡∏ß‡πÜ), ‡πÅ‡∏•‡∏∞ Queue ‡∏á‡∏≤‡∏ô |
| **Storage** | **AWS S3** (Private) | ‡πÄ‡∏Å‡πá‡∏ö‡∏£‡∏π‡∏õ‡∏™‡∏•‡∏¥‡∏õ‡πÅ‡∏•‡∏∞‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏û‡∏¥‡∏û‡∏≤‡∏ó (‡∏ï‡πâ‡∏≠‡∏á Encrypt ‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏ä‡πâ Signed URL) |
| **Security** | **Argon2 + AES-256** | Hash ‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô ‡πÅ‡∏•‡∏∞‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡∏´‡∏±‡∏™‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô DB |
| **Automation** | **APScheduler** | ‡∏£‡∏∞‡∏ö‡∏ö **Auto-Release** ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ó‡∏∏‡∏Å 1 ‡∏ô‡∏≤‡∏ó‡∏µ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏ï‡∏≤‡∏°‡∏Å‡∏é 48 ‡∏ä‡∏° |

---

### **Phase 1: Foundation & Infrastructure (‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏ó‡∏µ‡πà 1-2)**
‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á‡πÄ‡∏ü‡∏™‡∏ô‡∏µ‡πâ‡∏Ñ‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡πÄ‡∏ã‡πá‡∏ï‡∏≠‡∏±‡∏õ "‡∏Å‡∏£‡∏∞‡∏î‡∏π‡∏Å‡∏™‡∏±‡∏ô‡∏´‡∏•‡∏±‡∏á" ‡∏Ç‡∏≠‡∏á‡∏£‡∏∞‡∏ö‡∏ö‡πÉ‡∏´‡πâ‡πÅ‡∏Ç‡πá‡∏á‡πÅ‡∏£‡∏á‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡∏Ñ‡∏£‡∏±‡∏ö

**1. ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Stack ‡∏´‡∏•‡∏±‡∏Å (The Core)**
‚Ä¢ **Frontend:** ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏î‡πâ‡∏ß‡∏¢ **Next.js 14+ (App Router)** ‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏±‡∏ö **TypeScript** ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡∏Ç‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
‚Ä¢ **Backend:** ‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏î‡πâ‡∏ß‡∏¢ **FastAPI (Python 3.11+)** ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡πÅ‡∏ö‡∏ö Asynchronous ‡πÅ‡∏•‡∏∞‡πÉ‡∏ä‡πâ **Pydantic** ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏Ç‡πâ‡∏°‡∏á‡∏ß‡∏î
‚Ä¢ **Database:** ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô **PostgreSQL** ‡∏ö‡∏ô Managed Service ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö **ACID Compliance** ‡∏ã‡∏∂‡πà‡∏á‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏°‡∏≤‡∏Å‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô

### **2. ‡∏£‡∏∞‡∏ö‡∏ö‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏Ñ‡∏π‡πà (Double-Entry Ledger)**

‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô Schema ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ï‡∏≤‡∏£‡∏≤‡∏á ledger_entries ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ó‡∏∏‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏´‡∏ß‡∏Ç‡∏≠‡∏á‡πÄ‡∏á‡∏¥‡∏ô ‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ‡∏´‡∏•‡∏±‡∏Å‡∏Å‡∏≤‡∏£‡∏ó‡∏≤‡∏á‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå‡∏ó‡∏µ‡πà‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥:
$$\text{Account Balance} = \sum (\text{Debit}) - \sum (\text{Credit})$$
‚Ä¢ ‡∏ó‡∏∏‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÇ‡∏≠‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏´‡∏£‡∏∑‡∏≠‡∏≠‡∏≠‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏ñ‡∏π‡∏Å‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏õ‡πá‡∏ô 2 ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡πÄ‡∏™‡∏°‡∏≠ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏£‡∏±‡πà‡∏ß‡πÑ‡∏´‡∏•
‚Ä¢ ‡πÉ‡∏ä‡πâ‡∏ä‡∏ô‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• `NUMERIC(18, 2)` ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏ó‡∏®‡∏ô‡∏¥‡∏¢‡∏°‡πÄ‡∏û‡∏µ‡πâ‡∏¢‡∏ô‡∏à‡∏≤‡∏Å Floating point

### **Security & Identity (‡∏£‡∏∞‡∏ö‡∏ö‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ï‡∏±‡∏ß‡∏ï‡∏ô)**

‡∏´‡∏±‡∏ß‡πÉ‡∏à‡∏Ç‡∏≠‡∏á Depayit ‡∏Ñ‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏±‡πà‡∏ô (Trust) ‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏î‡πâ‡∏ß‡∏¢‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏´‡∏•‡πà‡∏≤‡∏ô‡∏µ‡πâ‡∏Ñ‡∏£‡∏±‡∏ö:
‚Ä¢ **Authentication:** ‡πÉ‡∏ä‡πâ **JWT (JSON Web Token)** ‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏±‡∏ö **HTTP-only Cookies** ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏à‡∏°‡∏ï‡∏µ‡πÅ‡∏ö‡∏ö XSS
‚Ä¢ **KYC Tier System:** ‡πÅ‡∏ö‡πà‡∏á‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ï‡∏≤‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á:
    ‚ó¶ **Tier 1:** ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå‡∏ú‡πà‡∏≤‡∏ô SMS OTP (‡∏ß‡∏á‡πÄ‡∏á‡∏¥‡∏ô‡∏à‡∏≥‡∏Å‡∏±‡∏î)
    ‚ó¶ **Tier 2:** ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ï‡∏±‡∏ß‡∏ï‡∏ô‡∏î‡πâ‡∏ß‡∏¢‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô (‡∏≠‡∏±‡∏õ‡πÄ‡∏Å‡∏£‡∏î‡∏ß‡∏á‡πÄ‡∏á‡∏¥‡∏ô)
‚Ä¢ **Data Privacy:** ‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡∏´‡∏±‡∏™‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡πà‡∏≠‡∏ô‡πÑ‡∏´‡∏ß (‡πÄ‡∏ä‡πà‡∏ô ‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£) ‡∏î‡πâ‡∏ß‡∏¢ **AES-256** ‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏Å‡πá‡∏ö‡∏•‡∏á‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏≤‡∏°‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô PDPA

---

## Phase 1: MVP Development (‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏ó‡∏µ‡πà 1 - 8)

‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏Ñ‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏∞‡∏ö‡∏ö‡∏ó‡∏µ‡πà‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡πÑ‡∏î‡πâ‡∏à‡∏£‡∏¥‡∏á ‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢ ‡πÅ‡∏•‡∏∞‡∏°‡∏µ‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ó‡∏µ‡πà‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥

- **‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏ó‡∏µ‡πà 1-2: Foundation & Identity (‡∏£‡∏≤‡∏Å‡∏ê‡∏≤‡∏ô‡πÅ‡∏•‡∏∞‡∏ï‡∏±‡∏ß‡∏ï‡∏ô)**
    - **Setup:** ‡∏ß‡∏≤‡∏á‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á Next.js (Frontend), FastAPI (Backend) ‡πÅ‡∏•‡∏∞ Docker
    - **DB Schema:** ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• PostgreSQL ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö User, KYC ‡πÅ‡∏•‡∏∞‡∏£‡∏∞‡∏ö‡∏ö Ledger
- **‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏ó‡∏µ‡πà 3-4: Transaction Core (‡∏´‡∏±‡∏ß‡πÉ‡∏à‡∏Å‡∏≤‡∏£‡∏ã‡∏∑‡πâ‡∏≠‡∏Ç‡∏≤‡∏¢)**
    - **Link Generation:** ‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡πÉ‡∏´‡πâ‡∏ú‡∏π‡πâ‡∏Ç‡∏≤‡∏¢‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢ (TXID) ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡∏≥‡∏´‡∏ô‡∏î PIN 6 ‡∏´‡∏•‡∏±‡∏Å
    - **Buyer View:** ‡∏ó‡∏≥‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ú‡∏π‡πâ‡∏ã‡∏∑‡πâ‡∏≠ (Mobile-First)
    - **Status Management:** ‡∏ß‡∏≤‡∏á‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ `CREATED` ‡πÅ‡∏•‡∏∞ `WAITING_PAYMENT`
- **‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏ó‡∏µ‡πà 5-6: Payment & Financial Integrity (‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡πÅ‡∏•‡∏∞‡∏ö‡∏±‡∏ç‡∏ä‡∏µ)**
    - **QR Integration:** ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏£‡∏∞‡∏ö‡∏ö PromptPay QR ‡πÅ‡∏•‡∏∞‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Webhook
    - **Double-Entry Ledger:** ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô Logic ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏Ñ‡∏π‡πà (Debit/Credit) ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥
    - **PDPA Implementation:** ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏ö‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡∏´‡∏±‡∏™ AES-256 ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡πÅ‡∏•‡∏∞‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô
- **‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏ó‡∏µ‡πà 7: Automation & Magic (‡∏£‡∏∞‡∏ö‡∏ö‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥)**
    - **Auto-Release Worker:** ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô Background Worker (APScheduler) ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏ä‡πá‡∏Ñ‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏´‡∏•‡∏±‡∏á 48 ‡∏ä‡∏°.
    - **Notification:** ‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ú‡πà‡∏≤‡∏ô Email/SMS ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏´‡∏£‡∏∑‡∏≠‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Ç‡∏≠‡∏á
- **‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏ó‡∏µ‡πà 8: Dispute & Launch (‡∏Ç‡πâ‡∏≠‡∏û‡∏¥‡∏û‡∏≤‡∏ó‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏¥‡∏î‡∏ï‡∏±‡∏ß)**
    - **Dispute System:** ‡∏ó‡∏≥‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå "Freeze" ‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏ã‡∏∑‡πâ‡∏≠‡πÅ‡∏à‡πâ‡∏á‡∏õ‡∏±‡∏ç‡∏´‡∏≤
    - **Admin Dashboard:** ‡πÅ‡∏ú‡∏á‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Admin ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡πÅ‡∏•‡∏∞‡∏ï‡∏±‡∏î‡∏™‡∏¥‡∏ô‡∏Ç‡πâ‡∏≠‡∏û‡∏¥‡∏û‡∏≤‡∏ó
    - **Security Audit:** ‡∏ó‡∏≥ Pentest ‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô‡πÅ‡∏•‡∏∞ Deploy ‡∏Ç‡∏∂‡πâ‡∏ô Production (AWS/GCP)

---

## Phase 2: Growth & Compliance (‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ó‡∏µ‡πà 3 - 6)

‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏Ñ‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ô‡πà‡∏≤‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏ñ‡∏∑‡∏≠‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏™‡∏ñ‡∏≤‡∏ö‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á

- **Official Bank API:** ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö Mock/Manual ‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Direct Bank API (‡πÄ‡∏ä‡πà‡∏ô SCB/KBank) ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏ñ‡∏µ‡∏¢‡∏£ 100%
- **Full e-KYC (Tier 3):** ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏£‡∏∞‡∏ö‡∏ö NDID ‡∏´‡∏£‡∏∑‡∏≠ e-KYC ‡∏Ç‡∏≠‡∏á‡∏£‡∏±‡∏ê ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏ò‡∏∏‡∏£‡∏Å‡∏£‡∏£‡∏°‡∏ß‡∏á‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏π‡∏á (>100,000 ‡∏ö‡∏≤‡∏ó)
- **Trust Score AI:** ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ô‡∏≥‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏ã‡∏∑‡πâ‡∏≠‡∏Ç‡∏≤‡∏¢‡∏°‡∏≤‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ô‡πà‡∏≤‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏ñ‡∏∑‡∏≠ (Trust Score) ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏∞‡∏ö‡∏ö Seller Rating
- **Customer Support Portal:** ‡∏£‡∏∞‡∏ö‡∏ö Chat ‡πÅ‡∏•‡∏∞ Ticket ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏Å‡πâ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡πÉ‡∏´‡πâ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏£‡∏ß‡∏î‡πÄ‡∏£‡πá‡∏ß

---

## Phase 3: Scale & Ecosystem (‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ó‡∏µ‡πà 6 ‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡πâ‡∏ô‡πÑ‡∏õ)

‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏Ñ‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡∏Ç‡∏¢‡∏≤‡∏¢‡πÅ‡∏û‡∏•‡∏ï‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÅ‡∏•‡∏∞‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∞‡∏î‡∏ß‡∏Å‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î

- **Native Mobile Apps:** ‡∏û‡∏±‡∏í‡∏ô‡∏≤‡πÅ‡∏≠‡∏õ‡∏û‡∏•‡∏¥‡πÄ‡∏Ñ‡∏ä‡∏±‡∏ô iOS ‡πÅ‡∏•‡∏∞ Android (Native) ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡∏£‡∏∞‡∏™‡∏ö‡∏Å‡∏≤‡∏£‡∏ì‡πå‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏•‡∏∑‡πà‡∏ô‡πÑ‡∏´‡∏•‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î
- **Logistic Partnership:** ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ API ‡∏Å‡∏±‡∏ö‡∏Ç‡∏ô‡∏™‡πà‡∏á‡∏ä‡∏±‡πâ‡∏ô‡∏ô‡∏≥ (Kerry, Flash, J&T) ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏∂‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Ç‡∏≠‡∏á‡∏°‡∏≤ Update ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
- **B2B Escalation:** ‡πÄ‡∏õ‡∏¥‡∏î API ‡πÉ‡∏´‡πâ‡πÄ‡∏ß‡πá‡∏ö Marketplace ‡∏≠‡∏∑‡πà‡∏ô‡πÜ ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ô‡∏≥‡∏£‡∏∞‡∏ö‡∏ö Soft Escrow ‡∏Ç‡∏≠‡∏á Depayit ‡πÑ‡∏õ‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ
- **Regional Expansion:** ‡∏Ç‡∏¢‡∏≤‡∏¢‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏á‡∏¥‡∏ô‡πÉ‡∏ô‡∏†‡∏π‡∏°‡∏¥‡∏†‡∏≤‡∏Ñ SEA (Cross-border QR Payment)
